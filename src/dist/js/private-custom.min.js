var app=angular.module("Bloombees",["ui.router","ngCookies","ngAnimate","ngResource","ngDialog","angularMoment","rzModule","LocalStorageModule","dndLists","ngTagsInput","720kb.socialshare"]);app.run(["$rootScope","$timeout","$document","$state","$stateParams","$http","$cookies","ENVIRONMENT",function(e,t,r,n,a,o,i,s){var l=r.find(".loader-container");e.$state=n,e.$stateParams=a,e.$on("$stateChangeStart",function(e){var t=location.hash.substring(1);i.get("bbtoken")||(e.preventDefault(),location.href=location.origin+"?next="+t+"#login"),l.addClass("active"),r.scrollTop(0)}),e.$on("$stateChangeSuccess",function(){t(function(){l.addClass("animated zoomOut"),t(function(){l.removeClass("active animated zoomOut")},350)},100)}),o.defaults.headers.common["X-DS-TOKEN"]=i.get("bbtoken"),o.defaults.headers.common["X-EXTRA-INFO"]=i.get("bbhash"),o.defaults.headers.common["X-WEB-KEY"]=s}]),app.config(["$locationProvider","$urlRouterProvider","$httpProvider","localStorageServiceProvider","ROUTES","routesSrvProvider","$stateProvider",function(e,t,r,n,a,o,i){var s,l,c;e.html5Mode(!0),r.defaults.useXDomain=!0,delete r.defaults.headers.common["X-Requested-With"],n.setPrefix("bloombees"),s={name:"private",url:"",abstract:!0,template:"<ui-view/>",resolve:{userInfo:["userInfoSrv","loginSrv","$cookies",function(e,t,r){var n={};return r.get("bbtoken")&&(n=e.getUserInfo()),n}]}},l=o.$get(),c=l.getRoutesAsStates(),i.state(s),Object.keys(a).forEach(function(e){i.state({name:"private."+e,url:"/"+e,abstract:!0,template:"<ui-view/>",params:{userType:e},resolve:{userType:["$stateParams",function(e){return e.userType}]}})}),c.forEach(i.state),t.otherwise("/merchant/dashboard")}]),app.constant("ROUTES",{merchant:{dashboard:{name:"private.merchant.dashboard",url:"/dashboard",templateUrl:"merchant/dashboard.html",label:"navigation_title_dashboard"},products:{name:"private.merchant.products",url:"/products",templateUrl:"merchant/products.html",label:"navigation_title_products",children:{myproducts:{name:"private.merchant.products.my-products",url:"/my-products",templateUrl:"merchant/products/my-products.html",label:"My products",icon:"bb-icon-store",children:{editproduct:{name:"private.merchant.products.edit",url:"/product/edit/{id}",templateUrl:"partials/product.html",hidden:!0},add:{name:"private.merchant.products.add",url:"/product/add",templateUrl:"merchant/products/add.html",hidden:!0}}},buybutton:{name:"private.merchant.products.buy-button",url:"/buy-button",templateUrl:"merchant/products/buy-button.html",icon:"bb-icon-tag",label:"buy button"},import:{name:"private.merchant.products.import",url:"/import",templateUrl:"merchant/products/import.html",icon:"bb-icon-cloud-download-o",label:"import"}}},orders:{name:"private.merchant.orders",url:"/orders",templateUrl:"merchant/orders.html",label:"navigation_title_orders",children:{toprocess:{name:"private.merchant.orders.process",url:"/process",templateUrl:"merchant/orders/process.html",icon:"icon-loading",label:"to process"},inshipping:{name:"private.merchant.orders.shipping",url:"/shipping",templateUrl:"merchant/orders/shipping.html",icon:"icon-shipping",label:"in shipping"},pickupinstore:{name:"private.merchant.orders.store",url:"/store",templateUrl:"merchant/orders/store.html",icon:"icon-store",label:"pickup in store"},delivered:{name:"private.merchant.orders.delivered",url:"/delivered",templateUrl:"merchant/orders/delivered.html",icon:"icon-package",label:"delivered"},refunded:{name:"private.merchant.orders.refunded",url:"/refunded",templateUrl:"merchant/orders/refunded.html",icon:"icon-bill",label:"refunded"}}},balance:{name:"private.merchant.balance",url:"/balance",templateUrl:"merchant/balance.html",label:"navigation_title_balance"},reviews:{name:"private.merchant.reviews",url:"/reviews",templateUrl:"merchant/reviews.html",label:"navigation_title_reviews"},settings:{name:"private.merchant.settings",url:"/settings",templateUrl:"merchant/settings.html",label:"navigation_title_settings",children:{mystore:{name:"private.merchant.settings.store",url:"/store",templateUrl:"merchant/settings/store.html",icon:"bb-icon-store",label:"my store"},shipping:{name:"private.merchant.settings.shipping",url:"/shipping",templateUrl:"merchant/settings/shipping.html",icon:"bb-icon-domestic",label:"shipping methods"},payout:{name:"private.merchant.settings.payout",url:"/payout",templateUrl:"merchant/settings/payout.html",icon:"bb-icon-payment-info",label:"payout methods"},payment:{name:"private.merchant.settings.payment",url:"/payment",templateUrl:"merchant/settings/payment.html",icon:"bb-icon-credit-card",label:"payment methods",children:{mycards:{name:"private.merchant.settings.payment.mycards",url:"/my-cards",templateUrl:"merchant/settings/payment/mycards.html",label:"My cards"},addcard:{name:"private.merchant.settings.payment.addcard",url:"/add-card",templateUrl:"merchant/settings/payment/addcard.html",label:"Add card"}}},profile:{name:"private.merchant.settings.profile",url:"/profile",templateUrl:"merchant/settings/profile.html",icon:"bb-icon-person",label:"my profile"},plans:{name:"private.merchant.settings.plans",url:"/plans",templateUrl:"merchant/settings/plans.html",icon:"bb-icon-plans",label:"plans",children:{plansplans:{name:"private.merchant.settings.plans.plans",url:"/plans",templateUrl:"merchant/settings/plans/plans.html",label:"plans"},plansreceipts:{name:"private.merchant.settings.plans.receipts",url:"/receipts",templateUrl:"merchant/settings/plans/receipts.html",label:"receipts",children:{receiptdetail:{name:"private.merchant.settings.plans.receiptdetail",url:"/receipts/{id}",templateUrl:"merchant/settings/plans/receipts/receipt-detail.html",controller:"ReceiptDetailController",controllerAs:"receiptDetail"}}}}}}},chat:{name:"private.merchant.chat",url:"/chat",templateUrl:"merchant/chat.html",label:"navigation_title_chat"}},influencer:{dashboard:{name:"private.influencer.dashboard",url:"/dashboard",templateUrl:"influencer/dashboard.html",label:"navigation_title_dashboard",resolve:{dashboard:["$q","influencerDashboardSrv",function(e,t){var r=e.defer();return t.dashboard?r.resolve():t.getDashboardData().then(function(e){t.dashboard=e.data.PromoterDashboard,r.resolve()}),r.promise}]}},storefront:{name:"private.influencer.storefront",url:"/storefront",templateUrl:"influencer/storefront.html",label:"navigation_title_storefront",resolve:{categories:["$q","LANGUAGE","discoverSrv",function(e,t,r){var n=e.defer();return r.categories.length>0?n.resolve():r.getCategories(t).then(function(e){r.categories=e.data.TagCats,n.resolve()}),n.promise}]}},performance:{name:"private.influencer.performance",url:"/performance",templateUrl:"influencer/performance.html",label:"navigation_title_performance",resolve:{categories:["$q","LANGUAGE","discoverSrv",function(e,t,r){var n=e.defer();return r.categories.length>0?n.resolve():r.getCategories(t).then(function(e){r.categories=e.data.TagCats,n.resolve()}),n.promise}]}},discover:{name:"private.influencer.discover",url:"/discover?view&cat&subcat&order&priceMin&priceMax&search",templateUrl:"influencer/discover.html",label:"navigation_title_discover",controller:"DiscoverController",controllerAs:"discover",resolve:{productSections:["$q","discoverSrv","$stateParams",function(e,t,r){var n=e.defer(),a=r.uniqueId||null;return t.sections?n.resolve():t.getProductSections(a).then(function(e){t.sections=e.data.Discover_sections,n.resolve()}),n.promise}],categories:["$q","LANGUAGE","discoverSrv",function(e,t,r){var n=e.defer();return r.categories.length>0?n.resolve():r.getCategories(t).then(function(e){r.categories=e.data.TagCats,n.resolve()}),n.promise}]}},balance:{name:"private.influencer.balance",url:"/balance",templateUrl:"influencer/balance.html",label:"navigation_title_balance"},settings:{name:"private.influencer.settings",url:"/settings",templateUrl:"influencer/settings.html",label:"navigation_title_settings",children:{storefront_details:{name:"private.influencer.settings.storefront_details",url:"/storefront_details",templateUrl:"influencer/settings/storefront_details.html",label:"storefront details",children:{details:{name:"private.influencer.settings.storefront_details.storefront_details",url:"/storefront_details",templateUrl:"influencer/settings/storefront_details/storefront_details.html",label:"storefront details",controller:"StorefrontDetailsController as storefrontDetails"},payment:{name:"private.influencer.settings.storefront_details.payment_info",url:"/payment_info",templateUrl:"influencer/settings/storefront_details/payment_info.html",label:"how to get paid",controller:"PaymentInfoController as paymentInfo"}}},personal_details:{name:"private.influencer.settings.personal_details",url:"/personal_details",templateUrl:"influencer/settings/personal_details.html",label:"personal details",children:{personal_details:{name:"private.influencer.settings.personal_details.personal_details",url:"/details",templateUrl:"influencer/settings/personal_details/personal_details.html",label:"personal details",controller:"PersonalDetailsController as personalDetails"},security:{name:"private.influencer.settings.personal_details.security",url:"/security",templateUrl:"influencer/settings/personal_details/security.html",label:"account security",controller:"SecurityController as security"},social_networks:{name:"private.influencer.settings.personal_details.social_networks",url:"/social_networks",templateUrl:"influencer/settings/personal_details/social_networks.html",label:"social networks"}}}}}},buyer:{dashboard:{name:"private.buyer.dashboard",url:"/dashboard",templateUrl:"buyer/dashboard.html",label:"navigation_title_dashboard"},payments:{name:"private.buyer.payments",url:"/payments",templateUrl:"buyer/payments.html",label:"navigation_title_payments"},purchases:{name:"private.buyer.purchases",url:"/purchases",templateUrl:"buyer/purchases.html",label:"navigation_title_purchases_only"},settings:{name:"private.buyer.settings",url:"/settings",templateUrl:"buyer/settings.html",label:"navigation_title_settings"}}}),app.service("routesSrv",["$q","$state","ROUTES",function(e,t,r){function n(){return r}function a(e,t){var n=[],o=e||r;return Object.keys(o).forEach(function(e){var r=o[e];r.hasOwnProperty("name")&&r.hasOwnProperty("url")?n.push(r):n=n.concat(a(r)),r.children&&!t&&(n=n.concat(a(r.children)))}),n}function o(e){var t=a(),r={};return t.forEach(function(t){t.name===e&&(r=t.children||{})}),r}function i(e){return o(e.name)}function s(e){var t=a(),r=null;return t.forEach(function(t){t.name===e&&(r=t||null)}),r}function l(){return s(t.current.name)}function c(e){var t=[];return a(e||r,!0).forEach(function(e){e.hidden||t.push({icon:e.icon||"",name:e.label,route:e.name})}),t}function u(e){var t={name:e.name,url:e.url,abstract:e.abstract||!1};return e.templateUrl&&(t.templateUrl=e.templateUrl),e.template&&(t.template=e.template),e.resolve&&(t.resolve=e.resolve),e.params&&(t.params=e.params),e.controller&&(t.controller=e.controller),e.controllerAs&&(t.controllerAs=e.controllerAs),t}function d(e){var t=[];return a(e||r).forEach(function(e){t.push(u(e))}),t}return{getAllRoutes:n,getRouteChildrenByState:i,getRoutesAsTabs:c,getRoutesAsStates:d,getRouteChildrenByStateName:o,getCurrentStateOptions:l,getStateOptionsByName:s}}]),app.service("callSrv",["$q","$http","BLOOMBEES_API_URL",function(e,t,r){function n(e,n,a,i){var s,l;return o[e]?l=o[e]:(s={method:n,url:r+a},i&&(s.data=i),l=t(s),o[e]=l),l}function a(e,t){return n(e,"GET",t)}var o={};return{get:a}}]),app.constant("CREDIT_CARD",{ENDPOINTS:{GET_CREDIT_CARDS:"/manage/users/%s/availableCreditCards",REQUEST_CREDENTIALS:"/manage/users/%s/addCreditCard?getCredentials",ADD_CREDIT_CARD:"/manage/users/%s/addCreditCard",DELETE_CREDIT_CARD:"/manage/users/%s/deleteCreditCard"},ICONS:{VSA:"bb-icon-pm-visa",MSC:"bb-icon-pm-mastercard",MAE:"bb-icon-pm-maestro",AMX:"bb-icon-pm-amex",JCB:"bb-icon-pm-jcb",DIM:"bb-icon-pm-dinnersclub"},BRAND_PATTERNS:{VSA:new RegExp("^4[0-9]{1,4}"),MSC:new RegExp("^5[1-5][0-9]{1,2}"),AMX:new RegExp("^3[47][0-9]{1,2}"),MAE:new RegExp("^(?:5[0678]\\d\\d|6304|6390|67\\d\\d)")}}),app.service("creditCardSrv",["$q","$http","CREDIT_CARD","userInfoSrv","BLOOMBEES_API_URL",function(e,t,r,n,a){function o(){var t=e.defer();return p?t.resolve():n.getUser().then(function(e){p=e.User_id,t.resolve()}),t.promise}function i(e){return{id:e.CreditCard_id,fapi_id:e.CreditCard_fapiId,name:e.CreditCard_holderName,brand:e.CreditCard_type,icon:r.ICONS[e.CreditCard_type]||"",maskedNumber:e.CreditCard_title,expiryDate:{month:0,year:0},billingAddress:{id:e.CreditCard_billingAddressId,address:e.CreditCard_billingAddress.Shipping_address,country:e.CreditCard_billingAddress.Shipping_isoCountry,city:e.CreditCard_billingAddress.Shipping_city,state:e.CreditCard_billingAddress.Shipping_state,postalCode:e.CreditCard_billingAddress.Shipping_zip}}}function s(){var n=e.defer();return o().then(function(){t.get(a+r.ENDPOINTS.GET_CREDIT_CARDS.replace("%s",p)).then(function(e){var t=e.data.data.User_creditCards,r=t.map(function(e){return i(e)});n.resolve(r)})}),n.promise}function l(e){return e.split(" ").join("")}function c(e){var t,n,a="",o=l(e);for(t in r.BRAND_PATTERNS)n=r.BRAND_PATTERNS[t],r.BRAND_PATTERNS.hasOwnProperty(t)&&n.test(o)&&(a=t);return a}function u(n){var i=e.defer(),s={Billing_address:n.billingAddress.address,Billing_city:n.billingAddress.city,Billing_state:n.billingAddress.state,Billing_zip:n.billingAddress.postalCode,Billing_isoCountry:n.billingAddress.country};return o().then(function(){t.post(a+r.ENDPOINTS.REQUEST_CREDENTIALS.replace("%s",p),s).then(function(e){var o,s;e.data.success?(o=e.data.data.body_template,s=e.data.data.url,o.CreditCardInfo={HolderName:n.name,CardNumber:l(n.number),VerificationCode:n.securityCode,ValidToYear:n.expiryDate.year,ValidToMonth:n.expiryDate.month},t({method:"POST",url:s,data:o,headers:{"X-WEB-KEY":void 0,"X-DS-TOKEN":void 0}}).then(function(e){var o,s={};e.data.CreditCardInfo?(o=e.data.CreditCardInfo[0],s={CreditCard_fapiId:o.CreditCardID,CreditCard_fapiAddressId:o.BillingAddress.AddressID,CreditCard_holderName:n.name,CreditCard_brand:c(n.number),CreditCard_isDefault:!0},t.post(a+r.ENDPOINTS.ADD_CREDIT_CARD.replace("%s",p),s).then(function(e){i.resolve({success:e.data.success||!1})})):i.resolve({success:!1,message:e.data.ResultMessage})})):i.resolve({success:!1})})}),i.promise}function d(n){var i=e.defer();return o().then(function(){var e={CreditCard_id:n};t.post(a+r.ENDPOINTS.DELETE_CREDIT_CARD.replace("%s",p),e).then(function(e){i.resolve(e.data.success||!1)})}),i.promise}var p;return{getCreditCards:s,createCreditCard:u,deleteCreditCard:d}}]),app.service("modalSrv",["$timeout","$storage","$cookies","ngDialog","translationsSrv","publicDataSrv","discoverSrv","$state",function(e,t,r,n,a,o,i,s){function l(e,t){return e&&t&&n.open({template:"partials/modals/notice.html",className:"ngdialog-theme-plain modal-notice",controller:function(){this.text=e,this.okLabel=t},controllerAs:"modal"}),null}function c(e){return n.open(e)}function u(e,t,r,a,o,i,s,l,c){var u,d=null;return e&&(u={template:e,className:"ngdialog-theme-plain"},t&&r&&(u.controller=t,u.controllerAs=r),l&&(u.preCloseCallback=l),o&&(u.resolve=o),a&&(u.className=u.className+" "+a),i&&(u.plain=i),s&&(u.data=s),c&&(u.showClose=!1,u.closeByEscape=!1,u.closeByDocument=!1),d=n.open(u)),d}function d(e,t,r){return n.openConfirm({template:"partials/modals/confirm.html",className:"ngdialog-theme-plain",controller:function(){e&&t&&r&&(this.text=e,this.yesLabel=t,this.noLabel=r)},controllerAs:"modal"})}function p(){n.closeAll()}function f(){l("Something went wrong","Ok")}function m(e){return u(e?'<signup-form bbcode="'+e+'"></signup-form>':"<signup-form></signup-form>",null,null,"signup-modal",null,!0)}function h(e){return u(e?'<login-form bbcode="'+e+'"></login-form>':"<login-form></login-form>",null,null,"login-modal",null,!0)}function g(){var e=window.sessionStorage;try{return e.setItem("test","1"),e.removeItem("test"),!0}catch(e){return!1}}function b(){var a=t.get("bloombees");g()?isAuth||(a?a.beeviral?a.beeviral.onboardingComplete||e(function(){n.openConfirm({template:"partials/modals/onboarding.html",className:"ngdialog-theme-default share-and-earn-modal onboarding-modal",closeByDocument:!1,plain:!1}).then(function(){a.beeviral.onboardingComplete=!0,t.set("bloombees",localStorage)})},100):(a.beeviral={onboardingComplete:!1},t.set("bloombees",a)):(t.set("bloombees",{beeviral:{onboardingComplete:!1}}),a=t.get("bloombees"),e(function(){n.openConfirm({template:"partials/modals/onboarding.html",className:"ngdialog-theme-default share-and-earn-modal onboarding-modal",closeByDocument:!1,plain:!1}).then(function(){a.beeviral.onboardingComplete=!0,t.set("bloombees",a)})},100))):(r.get("onboarding"),r.get("onboarding")||e(function(){n.openConfirm({template:"partials/modals/onboarding.html",className:"ngdialog-theme-default share-and-earn-modal onboarding-modal",closeByDocument:!1,plain:!1}).then(function(){r.put("onboarding",!0)})},100))}function v(t){var r,n,a,l,c=t.Product_isoCurrency||t.Performance_currencyIsoCode;return n=function(e,t){var r=Math.floor(e*t)/100;return parseFloat(r.toFixed(2))},l={currency:o.currencyToSymbol(c),product:t,commission:n(t.Product_price,t.Product_promoterCommissionPercent),resolved:!1},i.getProductByBbcode(l.product.Product_bbcode).then(function(t){l.product=angular.merge(l.product,t.data.Products[0]),l.product.Product_url=t.data.Products[0].Product_Url,e(function(){l.resolved=!0},200)}),a=function(){return s.go(s.current,{bbcode:null},{notify:!1,reload:!1}),!0},r=["$scope","$window","$resource","Socialshare","FACEBOOK_ID","DISCOVER","BLOOMBEES_API_URL",function(e,t,r,n,a,o,i){this.product=e.ngDialogData.product,this.voted=!1,this.shared=!1,this.params=s.params,this.params.bbcode=this.product.Product_bbcode,s.go(s.current,this.params,{reload:!1,notify:!1}),this.renderPrice=function(e){return parseFloat(Number(e).toFixed(2))},this.share=function(e){var t={socialshareUrl:this.product.Product_Url};"facebook"===e&&(t.socialshareVia=a),"email"===e&&(t.socialshareSubject="Subject here",t.socialshareBody="Email body here"),n.share({provider:e,attrs:t}),this.shared=!0},this.closeModal=function(){p()},this.keepSharing=function(){this.shared=!1,r(i+o.ENDPOINTS.SOCIALNETWORK).get()},this.copyLink=function(e){var r,n=angular.element(t.document.body),a=angular.element("<textarea/>");a.css({position:"fixed",opacity:"0"}),a.val(e),n.append(a),a[0].select(),r=document.execCommand("copy");try{if(!(r=document.execCommand("copy")))throw r}catch(r){t.prompt("Copy to clipboard, please",e)}a.remove()}}],u("partials/modals/discover-share-and-earn.html",r,"$ctrl","share-and-earn-modal",null,!1,l,a)}function S(){return n.getOpenDialogs()}return{notice:l,confirm:d,open:u,openWithOptions:c,closeAll:p,defaultNotice:f,signup:m,login:h,onboarding:b,shareAndEarn:v,getOpenDialogs:S}}]),app.constant("TRANSLATIONS",{TRANSLATIONS_ENDPOINT:"/public/resources/translations/",TRANSLATIONS_PREFFIX:"bloombees;webapp;"}),app.service("translationsSrv",function(){function e(e){var t=angular.element("translations")[0],r=e.split(";"),n=4===r.length?r[2]+"_"+r[3]:r[0]+"_"+r[1];return t.dataset[n]}return{getTranslationFromElement:e}}),app.constant("PUBLIC_DATA",{ENDPOINTS:{COUNTRIES:"/public/data/countries",CURRENCIES:"/checkouts/currencies",TIMEZONES:"/checkouts/timezones",CURRENCY_EXCHANGE:"/finances/exchange"},DEFAULTS:{CURRENCY:{Currency_isoCode:"EUR",Currency_symbol:"€"}},CURRENCIES:{EUR:"€",USD:"$",RUB:"₽",PLN:"zł",GBP:"£"},DAYS_PER_MONTH:[31,29,31,30,31,30,31,31,30,31,30,31]}),app.service("publicDataSrv",["$q","$http","$resource","PUBLIC_DATA","BLOOMBEES_API_URL","callSrv",function(e,t,r,n,a,o){function i(){return o.get("countries",n.ENDPOINTS.COUNTRIES).then(function(e){var t,r,n=[];if(e.data&&e.data.data&&e.data.data.iso){t=e.data.data.iso,b=e.data.data.geo;for(r in t)t.hasOwnProperty(r)&&n.push(t[r])}return n})}function s(){var t=e.defer();return b?t.resolve(b):i().then(function(){t.resolve(b)},t.resolve),t.promise}function l(){var e,t=[];for(e=0;e<=11;e++)t[e]=e+1;return t}function c(e){var t,r=[],n=(new Date).getFullYear(),a=e||10;if(a>=0)for(t=0;t<=a;t++)r[t]=t+n;else for(t=0;t>a;t--)r.push(t+n);return r}function u(e){var t,r=n.DAYS_PER_MONTH[e-1],a=[];for(t=0;t<r;t++)a.push(t+1);return a}function d(e){return n.CURRENCIES[e]||e}function p(e){return n.CURRENCIES[e]||null}function f(){return o.get("currencies",n.ENDPOINTS.CURRENCIES).then(function(e){var t=null;return e.data&&e.data.success&&e.data.data&&(t=e.data.data),t})}function m(e){return v.Currency_isoCode!==e.Currency_isoCode&&(v=e),v}function h(){return v}function g(){var t=e.defer();return o.get("timezones",n.ENDPOINTS.TIMEZONES).then(function(e){var r=e.data.data;r&&r.Timezones?t.resolve(r.Timezones):t.reject(e)},t.reject),t.promise}var b=null,v=n.DEFAULTS.CURRENCY;return{getCountries:i,getGeo:s,getMonths:l,getYears:c,getDays:u,currencyToSymbol:d,getCurrencySymbol:p,getCurrencies:f,getActiveCurrency:h,changeCurrency:m,getTimezones:g}}]),app.service("userInfoSrv",["$log","$http","$q","$resource","$cookies","USER_ID","ENVIRONMENT","BLOOMBEES_API_URL",function(e,t,r,n,a,o,i,s){var l=this;l.hash=a.get("bbhash"),l.headers={token:{"X-DS-TOKEN":a.get("bbtoken")},webKey:{"X-WEB-KEY":i}},l.current={},l.user={},l.store={},l.isLoaded=!1,l.get=function(e){return n("/dev_api").get({file:e}).$promise},l.getUserById=function(e){return n(s+"/users/byid/:id",{id:e},{get:{method:"GET",headers:l.headers.token}}).get().$promise},l.getStoreById=function(e){return n(s+"/manage/stores/:id",{id:e},{get:{method:"GET",headers:l.headers.token}}).get().$promise},l.getProductById=function(e){return n(s+"/checkouts/bybbcode/:id",{id:e},{get:{method:"GET",headers:l.headers.webKey}}).get().$promise},l.getStoreProducts=function(e,t){return n(s+"/checkouts/bystore/:store",{store:l.store.Store_uniqueId,offset:e,limit:t},{get:{method:"GET",headers:l.headers.webKey}}).get().$promise},l.getStore=function(){return l.init().then(function(){return l.store})},l.getUser=function(){return l.init().then(function(){return l.user})},l.getUserInfo=function(){return l.init().then(function(){return{user:l.user,store:l.store,headers:l.headers}})},l.init=function(){var e=r.defer();return l.isLoaded?e.resolve(l.isLoaded):isAuth?l.getUserById(o).then(function(t){l.user=t.data,l.getStoreById(t.Store_id).then(function(t){l.store=t.data,l.isLoaded=!0,e.resolve(l.isLoaded)})}):e.resolve(l.isLoaded),e.promise}}]),app.filter("capitalize",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}}),app.directive("bbAlert",["$timeout",function(e){return{restrict:"E",replace:!0,templateUrl:"components/bb-alert.component.html",controllerAs:"bbAlert",link:function(t,r,n,a){var o,i=r.find(".bb-alert");t.closeAlert=function(){i.addClass("zoomOut"),i.removeClass("fadeInUp"),e(function(){a.setMessageAndType(null,null)},500),e.cancel(o)},t.getAlertType=function(){return"bb-alert-icon__"+a.type},t.$on("alert",function(r,n){a.setMessageAndType(n.message,n.type),i.removeClass("zoomOut"),i.addClass("fadeInUp"),o=e(function(){t.closeAlert()},5500)}),t.$on("destroy",function(){t.closeAlert()})},controller:function(){var e=this;e.setMessageAndType=function(t,r){e.message=t,e.type=r}}}}]),app.component("bbPrimaryTabs",{templateUrl:"components/bb-primary-tabs.html",controllerAs:"bbPrimaryTabsController",restrict:"E",replace:!0,bindings:{basePath:"@",detail:"<?"},controller:["$state","$rootScope","routesSrv",function(e,t,r){var n=this;n.detail=n.detail||{},n.tabs=[],n.hideTabs=!1,t.$on("$stateChangeSuccess",function(t,a){var o=r.getCurrentStateOptions();n.hideTabs=o&&o.hidden,n.tabs.length&&a.name===n.basePath&&e.go(n.tabs[0].route)}),function(){var t=r.getRouteChildrenByStateName(n.basePath);n.tabs=r.getRoutesAsTabs(t),n.tabs.length&&e.$current.name===n.basePath&&e.go(n.tabs[0].route),n.detail&&n.tabs.forEach(function(e){var t=n.detail[e.name];t&&(e.colorClass=t.colorClass,e.text=t.text)})}()}]}),app.component("bbSecondaryTabs",{templateUrl:"components/bb-secondary-tabs.html",controllerAs:"bbSecondaryTabsController",restrict:"E",replace:!0,bindings:{basePath:"@"},controller:["$rootScope","$state","routesSrv",function(e,t,r){function n(){a.tabs.forEach(function(e){var n,a,o=r.getRouteChildrenByStateName(e.route);e.isActive=!1;for(a in o)o.hasOwnProperty(a)&&(n=o[a],n.name===t.current.name&&(e.isActive=!0))})}var a=this;a.tabs=[],e.$on("$stateChangeSuccess",n),function(){var e=r.getRouteChildrenByStateName(a.basePath);a.tabs=r.getRoutesAsTabs(e),a.basePath===t.$current.name&&t.go(a.tabs[0].route),n()}()}]}),app.directive("bbSwitch",function(){return{replace:!0,transclude:!0,templateUrl:"components/bb-switch.html",controllerAs:"bbSwitchController",scope:{},require:["bbSwitch","ngModel"],restrict:"E",controller:function(){var e,t=this;t.changeValue=function(){t.active=!t.active,t.setValue(t.active)},t.init=function(r,n){e=n,e.$render=angular.bind(t,t.render)},t.render=function(){t.active=e.$viewValue},t.setValue=function(t){e.$setViewValue(t)}},link:function(e,t,r,n){var a=n[0],o=n[1];a.init(e,o)}}}),app.component("bbTable",{replace:!0,restrict:"E",templateUrl:"components/bb-table.html",controllerAs:"tableCtrl",bindings:{loadItems:"&",onItemClick:"&",columns:"<",totalItems:"@",hasPagination:"<",fixedPageSize:"<"},controller:["BB_TABLE",function(e){function t(){var e=r.pageSize*r.page;r.loading=!0,n(r.sortingBy.field,r.sortingBy.order,e,r.pageSize).then(function(t){r.itemsOnDisplay=t,r.loading=!1,r.showing={from:e,to:e+t.length},r.inLastPage=t.length<r.pageSize||r.totalItems&&r.showing.to===Number(r.totalItems)},function(){r.loading=!1})}var r=this,n=r.loadItems(),a=r.onItemClick();r.itemsAreNotClickable=!a,r.onItemClick=a||angular.noop,r.itemsOnDisplay=[],r.ORDER=e.ORDER,r.PAGE_SIZES=e.PAGE_SIZES,r.loading=!1,r.inLastPage=!1,r.showing={from:0,to:0},function(){r.columns&&r.columns.length&&(r.pageSize=r.fixedPageSize||e.PAGE_SIZES[0],r.page=0,r.sortingBy={field:r.columns[0].field,order:e.ORDER.DESCENDING},t())}(),r.next=function(){r.page++,t()},r.prev=function(){r.page--,t()},r.onPageSizeChange=function(){r.page=0,t()},r.orderBy=function(n){r.sortingBy.field===n?r.sortingBy.order===e.ORDER.DESCENDING?r.sortingBy.order=e.ORDER.ASCENDING:r.sortingBy.order=e.ORDER.DESCENDING:r.sortingBy={field:n,order:e.ORDER.DESCENDING},r.page=0,t()}}]}),app.constant("BB_TABLE",{PAGE_SIZES:[10,50,100],ORDER:{ASCENDING:-1,DESCENDING:1}}),app.constant("BB_TIME_CHART",{colors:{corporate:"#2ec6c6",grey:"#ededed",white:"rgb(255, 255, 255)"},time_units:{year:"year",month:"month",week:"week",day:"day",hour:"hour"},time_filters:{this_year:"year",this_month:"month",this_week:"week",this_day:"day",this_hour:"hour",all:"all"},chart_type:"line"}),app.directive("bbTimeChart",["$log","$timeout","moment","BB_TIME_CHART",function(e,t,r,n){return{restrict:"E",replace:!0,templateUrl:"components/bb-time-chart.html",scope:{chartData:"=chartsData",series:"@chartsSeries",userType:"@chartFor",defaultFilter:"=?defaultFilter"},controllerAs:"timeChartController",controller:["$scope","$log","BB_TIME_CHART",function(e,t,n){function a(t,r){i&&(i.data.datasets=[{label:e.series,data:t}],i.data.labels=r,i.options.scales.xAxes[0].time.unit=s.filter,i.update())}function o(t){var r=e.chartData[t];return!r||angular.isArray(r)?(s.noData=!0,{}):(s.noData=!1,r)}var i,s=this,l=e.defaultFilter||n.time_units.month;s.noData=!1,s.time_filters=n.time_filters,s.filter=null,e.init=function(t){i=new Chart(t,{type:n.chart_type,data:{labels:[],datasets:[{label:e.series,data:[]}]},options:{title:!1,responsive:!0,layout:{padding:30},legend:{display:!1},tooltips:{displayColors:!1,callbacks:{title:function(e){var t=i.options.scales.xAxes[0].time,n=t.unit,a=t.displayFormats[n];return r(e[0].xLabel).format(a)}}},defaultFontFamily:"roboto_regular, sans-serif",colors:[n.colors.corporate],defaultColor:n.colors.corporate,scales:{yAxes:[{gridLines:{display:!1},stacked:!0}],xAxes:[{type:"time",time:{unit:l,displayFormats:{millisecond:"YYYY-MM-DD HH:mm:ss",second:"YYYY-MM-DD HH:mm:ss",hour:"YYYY-MM-DD HH:mm:ss",day:"YYYY-MM-DD",week:"YYYY-MM-DD",month:"YYYY-MM-DD",quarter:"YYYY-MM-DD",year:"YYYY-MM"}},gridLines:{drawTicks:!1,color:n.colors.grey,zeroLineColor:n.colors.grey},ticks:{beginAtZero:!0,tickMarkLength:30,offsetGridLines:!0}}]},elements:{line:{borderColor:n.colors.corporate,borderWidth:2,tension:.2,backgroundColor:n.colors.white,fill:"top"},point:{radius:4,backgroundColor:n.colors.corporate,borderWidth:1,borderColor:n.colors.white,hoverBorderWidth:3,hoverRadius:5}}}}),s.setFilter(l)},s.setFilter=function(e){var t=[],n=[],i=o(e);s.filter=e,angular.equals({},i)||(angular.forEach(i,function(e,a){t.push(r(a).utc().format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")),n.push(e.Promoter_sales)}),a(n,t))}}],link:function(e,r){var n=angular.element(r.find("canvas"))[0];t(function(){e.init(n)})}}}]),app.directive("bbTooltip",["$log",function(e){return{restrict:"A",scope:{title:"@bbTooltip",placement:"@bbTooltipPlacement"},link:function(e,t){var r=angular.element(t)[0],n={title:e.title,placement:e.placement||"top"};$(r).tooltip(n),t.hover(function(){$(r).tooltip("show")},function(){$(r).tooltip("hide")})}}}]),app.directive("bbValidateForm",["$log","bbValidateFormSrv",function(e,t){return{restrict:"A",link:function(e,r,n){var a,o,i,s,l,c=angular.element(r)[0];a=$(c),s=a.find(".bb-input"),l=function(){o=!0,i=!0,s.each(function(){$(this).hasClass("touched")||(i=!1),!$(this).hasClass("has-error")&&i||(o=!1)}),o?(a.addClass("valid"),$('button[type="submit"]').prop("disabled",!1)):(a.removeClass("valid"),$('button[type="submit"]').prop("disabled",!0))},s.each(function(e,r){var n,a,o,i,c;n=$(r),a=$("input, textarea",n),o=$(".form-alert",n),i=function(e){n.addClass("has-error"),o.find("[data-error]").each(function(){$(this).removeClass("active")}),o.find('[data-error="'+e+'"]').addClass("active")},c=function(){var e,r;e=a.val(),r=t.validateField(e,a,s),n.removeClass("has-error"),r?(n.removeClass("has-value"),i(r)):n.addClass("has-value")},a.on("focus",function(){n.addClass("dirty")}),a.on("blur input",function(){var e=a.val();e&&e.length&&n.addClass("dirty"),$(".has-value").length===s.length-1&&n.addClass("touched"),n.hasClass("touched")&&c(),l()}),a.on("change",function(){n.hasClass("touched")||c(),n.addClass("touched")})})}}}]),app.service("bbValidateFormSrv",function(){function e(e,t){var r,n;return t?(r=new RegExp(t),n=r.test(e)):n=!0,n}function t(e,t){var r=!e||!e.length;return!(t&&r)}function r(e,t){return!t||e.length>=t}function n(e,t){return!t||e.length<=t}function a(e,t){return!t||e===t}function o(o,i,s){var l=s.find('[name="password"]'),c="";return t(o,i.attr("required"))||(c="required"),r(o,i.attr("minlength"))||(c="minlength"),n(o,i.attr("maxlength"))||(c="maxlength"),e(o,i.attr("pattern"))||(c="pattern"),"checkPassword"===i.attr("name")&&l&&!a(o,l.val())&&(c="checkPassword"),c||null}return{validateField:o}}),app.component("creditCardForm",{replace:!0,restrict:"E",templateUrl:"partials/credit-card-form.html",controllerAs:"creditCardFormController",bindings:{callback:"&",cancelCallback:"&"},controller:["CREDIT_CARD_FORM","publicDataSrv",function(e,t){var r=this,n=r.callback();r.cancelCallback&&(r.cancel=r.cancelCallback()),r.FIELDS=e.FIELDS,r.creditCard={number:"",name:"",brand:"",icon:"",maskedNumber:"",expiryDate:{month:0,year:0},securityCode:"",billingAddress:{address:"",country:"",city:"",state:"",postalCode:""}},r.years=t.getYears(),r.creditCard.expiryDate.year=r.years[0],r.months=t.getMonths(),r.creditCard.expiryDate.month=r.months[0],r.countries=[],r.submitForm=function(){n(angular.copy(r.creditCard))},function(){t.getCountries().then(function(e){r.countries=e,r.creditCard.billingAddress.country=e[0].iso})}()}]}),app.constant("CREDIT_CARD_FORM",{FIELDS:{CVV:{MIN_LENGTH:3,MAX_LENGTH:4},NUMBER:{MIN_LENGTH:12,MAX_LENGTH:23},NAME:{MIN_LENGTH:4}}}),app.component("currencySwitcher",{replace:!0,restrict:"E",bindings:{onChange:"&"},
templateUrl:"components/currency-switcher.component.html",controller:["$log","$rootScope","$timeout","userInfoSrv","publicDataSrv",function(e,t,r,n,a){var o=this;o.selectedCurrency=a.getActiveCurrency(),o.currencies=[],o.setActive=function(e){o.selectedCurrency.Currency_isoCode!==e.Currency_isoCode&&(r(function(){t.$emit("currencyChanged",{lang:e.Currency_isoCode})}),o.selectedCurrency=a.changeCurrency(e))},o.$onInit=function(){a.getCurrencies().then(function(e){o.currencies=e})}}]}),app.component("dashboardTitleBlock",{controllerAs:"dashboardBlock",bindings:{options:"<",type:"@"},templateUrl:"partials/dashboard-title-block.html",controller:function(){function e(e){var t,n=e.toString().length,a=r.defaultSize;for(t=0;t<r.steps.length;t++)n>r.steps[t].min&&(a=r.steps[t].size);return a}var t=[this.options.mainValue,this.options.secondValue,this.options.total],r={defaultSize:"fs-38",steps:[{min:3,size:"fs-33"},{min:4,size:"fs-25"},{min:5,size:"fs-19"},{min:6,size:"fs-15"}]};this.options=this.options||{},this.type=this.type||"",t.forEach(function(t){t&&t.hasOwnProperty("amount")&&(t.fontSize=e(t.amount))})}}),app.component("helpCenter",{templateUrl:"partials/help-center.html",controllerAs:"helpCenterController",restrict:"E",replace:!0,bindings:{options:"<"}}),app.constant("HELP_CENTER",{MERCHANT:{TITLE:"Seller's Handbook",PICTURE_CLASS:"private-help-girl",BUTTON:{URL:"/sellers-handbook",TEXT:"Let's learn!"},HANDBOOK_LINK:{URL:"/sellers-handbook",TEXT:"Seller's Handbook"}},INFLUENCER:{TITLE:"Promoter's Handbook",PICTURE_CLASS:"rocket",BUTTON:{URL:"/sellers-handbook",TEXT:"Read up!"},HANDBOOK_LINK:{URL:"/sellers-handbook",TEXT:"Promoter's Handbook"}}}),app.factory("httpHeaders",["$q","$cookies","ENVIRONMENT",function(e,t,r){return{request:function(e){var n=t.get("bbtoken");return e.headers=e.headers||{},n&&(e.headers["X-WEB-KEY"]=r,e.headers["X-DS-TOKEN"]=n),e},responseError:function(t){return e.reject(t)}}}]),app.directive("multiTemplateCard",function(){return{templateUrl:"partials/multi-template-card.html",transclude:!0,replace:!0,require:["multiTemplateCard"],restrict:"E",controllerAs:"multiTemplateCard",controller:function(){function e(e){var n=t.width(),a=-(n*e);r.cssTransform.transform="translateX("+a+"px)"}var t,r=this;r.cssTransform={},r.currentIndex=0,r.init=function(e){var n=e.children()[0];r.elementCount=angular.element(n).children().length,t=e},r.next=function(){r.currentIndex<=r.elementCount-1&&(r.currentIndex++,e(r.currentIndex))},r.prev=function(){r.currentIndex>0&&(r.currentIndex--,e(r.currentIndex))}},link:function(e,t,r,n){n[0].init(t)}}}),app.component("productRowPerformance",{templateUrl:"components/product-row-performance.html",bindings:{product:"<"},controller:["$log","modalSrv",function(e,t){var r=this;r.totalShares=0,r.getCommission=function(e,t){var r=Math.floor(e*t)/100;return parseFloat(r.toFixed(2))},r.getIconClass=function(e){return"whatsapp"===e?"icon-bb icon-whatsapp":"icon bb-icon-"+e.toLowerCase()},r.renderPrice=function(e){return parseFloat(Number(e).toFixed(2))},r.setProductImage=function(e){return{backgroundImage:"url("+e+")"}},r.shareAgain=function(){t.shareAndEarn(r.product)},r.showSharesDetails=function(){t.openWithOptions({template:"partials/modals/details-shares.html",controller:["modalSrv",function(e){var t=this;t.getIconClass=function(e){return"whatsapp"===e?"icon-bb icon-whatsapp":"icon bb-icon-"+e.toLowerCase()},t.shareAgain=function(t){e.closeAll(),e.shareAndEarn(t)}}],controllerAs:"$ctrl",appendClassName:"performance-details-modal",plain:!1,closeByNavigation:!0,data:r.product})},r.showEarningsDetails=function(){t.openWithOptions({template:"partials/modals/details-earnings.html",controller:["publicDataSrv",function(e){var t=this;t.getCurrency=function(t){return e.currencyToSymbol(t)},t.renderPrice=function(e){return parseFloat(Number(e).toFixed(2))}}],controllerAs:"$ctrl",appendClassName:"performance-details-modal",plain:!1,closeByNavigation:!0,data:r.product})},r.$onInit=function(){var e;for(e=0;e<r.product.Performance_socialNetWorks.length;e++)r.totalShares+=r.product.Performance_socialNetWorks[e].shares}}]}),app.directive("setLang",["$window","$location",function(e,t){return{restrict:"A",link:function(r,n,a){t.search("lang",null),n.click(function(r){r.preventDefault(),t.search("lang",a.setLang),e.location.replace(t.absUrl())})}}}]),app.component("socialNetworks",{templateUrl:"partials/social-networks.html",bindings:{merchantMode:"<",embed:"<"},controllerAs:"socialNetworksController",controller:["$scope","socialNetworksSrv","SOCIAL_NETWORKS","ngDialog","$timeout","modalSrv",function(e,t,r,n,a,o){function i(){s.socialNetworks=[],s.$onInit()}var s=this,l=angular.element(".social_networks_translations")[0]||{},c=l.dataset||{};s.socialNetworks=[],s.$onInit=function(){t.getSocialNetworks().then(function(e){s.socialNetworks=e})},s.authenticate=function(e){e.isConnecting=!0,t.connectSocialNetwork(e.oAuthName).then(i,function(t){e.isConnecting=!1,403===t?o.notice(c.error_warning_login_email_exists,c.common_action_ok):o.defaultNotice()})},s.delete=function(e){o.confirm().then(function(){e.isConnecting=!0,n.close(),t.deleteSocialNetwork(e.id).then(function(t){e.isConnecting=!1,t?e.isAuth=!1:o.defaultNotice()},function(){o.defaultNotice(),e.isConnecting=!1})})},s.confirmDelete=function(){}}]}),app.constant("SOCIAL_NETWORKS",{ENDPOINT:"/socialnetworks/connections/",CONNECT_ENDPOINT:"/socialnetworks/connections/%s/oauthservice",OAUTH_CONNECT_URL:location.origin+"/oauthconnect/?privateoauthconnect={id}",OAUTH_WINDOW_OPTIONS:"location=0,status=0,width=800,height=400",NETWORKS:{Facebook:{name:"Facebook",icon:"facebook",oAuthName:"facebook",supportsPages:!0,supportsStore:!0},Google:{name:"Google+",icon:"google-plus",oAuthName:"google",supportsPages:!1,supportsStore:!1},Pinterest:{name:"Pinterest",icon:"pinterest",oAuthName:"pinterest",supportsPages:!0,supportsStore:!1},Instagram:{name:"Instagram",icon:"instagram",oAuthName:"instagram",supportsPages:!1,supportsStore:!1},Twitter:{name:"Twitter",icon:"twitter",oAuthName:"twitter",supportsPages:!1,supportsStore:!1}}}),app.service("socialNetworksSrv",["$q","$http","BLOOMBEES_API_URL","BLOOMBEES_OAUTH_URL","SOCIAL_NETWORKS","USER_ID","$cookies","$interval",function(e,t,r,n,a,o,i,s){function l(){return t.get(r+a.ENDPOINT+o).then(function(e){var t=null,r=e.data.data;return r&&r.SocialNetworks&&(t=r.SocialNetworks.map(function(e){return{id:e.SocialNetwork_id,name:e.SocialNetwork_name,profileName:e.SocialNetwork_userName,pageName:"",storeActivated:!1,isAuth:!0}})),t})}function c(){var e=localStorage.getItem("privateoauthconnect");return e?(localStorage.setItem("privateoauthconnect",null),t.post(r+a.CONNECT_ENDPOINT.replace("%s",o),{id:e}).then(function(e){return e.data.success})):null}function u(t){var r=n+"/"+t+"?ret="+a.OAUTH_CONNECT_URL,o=window.open(r,"",a.OAUTH_WINDOW_OPTIONS),i=e.defer(),l=s(function(){o.closed&&(s.cancel(l),c().then(function(e){e?i.resolve():i.reject()},function(e){i.reject(e.status)}))});return i.promise}function d(e){return t.delete(r+a.ENDPOINT+o+"/"+e).then(function(e){return e.data.success||!1})}function p(){var e=angular.copy(a.NETWORKS);return l().then(function(t){return t.forEach(function(t){e.hasOwnProperty(t.name)&&(e[t.name]=angular.merge({},t,e[t.name]))}),e})}return{getSocialNetworks:p,deleteSocialNetwork:d,connectSocialNetwork:u}}]),app.component("topPerformingNetworks",{templateUrl:"components/top-performing-networks.html",bindings:{data:"<"},controllerAs:"topPerformingNetworks",controller:["topPerformingNetworksSrv",function(e){var t=this;t.topPerformingNetworks={},t.$onInit=function(){t.topPerformingNetworks=e.renderData(t.data)}}]}),app.service("topPerformingNetworksSrv",function(){function e(e){var t,r;for(t in e)e.hasOwnProperty(t)&&(r=e[t],e[t].performance||(r.performance={percentage:0}));return delete e.total,e}return{renderData:e}}),app.component("topProductsBb",{templateUrl:"components/top-products-bb.html",bindings:{products:"<"},controllerAs:"topProductsBb",controller:["topProductsBbSrv",function(e){var t=this;t.topProducts=[],t.addedProducts=[],t.$onInit=function(){t.topProducts=t.products||[]},t.isAdded=function(e){return t.addedProducts.indexOf(e)>-1},t.assign=function(r){e.addProduct(r).then(function(e){e.success&&1===e.data.Products.length&&t.addedProducts.push(r)})}}]}),app.constant("TOP_PRODUCTS_BB",{ENDPOINTS:{ADD_PRODUCT:"/beeViral/storefront/products/:bb_user_id/:bb_product_id"}}),app.service("topProductsBbSrv",["$resource","TOP_PRODUCTS_BB","BLOOMBEES_API_URL","USER_ID",function(e,t,r,n){function a(a){return e(r+t.ENDPOINTS.ADD_PRODUCT,{bb_user_id:n,bb_product_id:a}).save().$promise}return{addProduct:a}}]),app.controller("TopnavController",["$rootScope","routesSrv","$state","$stateParams",function(e,t,r,n){var a=this,o=t.getAllRoutes(),i=angular.element(".private_topnav_translations")[0]||{},s=i.dataset||{};a.topnavLinks=[],a.translations=s,e.$on("$stateChangeSuccess",function(){Object.keys(o).forEach(function(e){n.userType===e&&(a.topnavLinks=t.getRoutesAsTabs(o[e]))})})}]),app.component("upgradeSubscriptionButton",{replace:!0,restrict:"E",template:'<a class="button button-action upgrade-subscription-button" ng-show="upgradeSubscriptionButton.isOnFreeTrial" ui-sref="{{upgradeSubscriptionButton.destRoute}}">{{upgradeSubscriptionButton.buttonText}}</a>',controllerAs:"upgradeSubscriptionButton",controller:["$rootScope","plansSrv","translationsSrv","PLANS","ROUTES",function(e,t,r,n,a){var o=this;o.isOnFreeTrial=!1,o.destRoute=a.merchant.settings.children.plans.children.plansplans.name,o.buttonText="",e.$on(n.CHANGED_PLAN_EVENT,function(e,t){o.isOnFreeTrial=Number(t)!==n.TRIAL_PLAN_ID}),function(){t.isTrialPeriodActive().then(function(e){o.isOnFreeTrial=e}),o.buttonText=r.getTranslationFromElement("subscription;action_upgrade_subscription_plan")}()}]}),app.controller("AddACardController",["$rootScope","ROUTES","$state","creditCardSrv","modalSrv","translationsSrv",function(e,t,r,n,a,o){function i(){r.go(t.merchant.settings.children.payment.children.mycards.name)}var s=this;s.loading=!1,this.createCallback=function(e){s.loading=!0,n.createCreditCard(e).then(function(e){s.loading=!1,e.success?i():o.getSectionTranslations("modals").then(function(t){a.notice(e.message||t.default_notice,t.default_ok)})})}}]),app.controller("MyCardsController",["$scope","$state","ROUTES","creditCardSrv","modalSrv","translationsSrv",function(e,t,r,n,a,o){function i(){return u.loadingCreditCards=!0,n.getCreditCards().then(function(e){u.creditCards=e,u.loadingCreditCards=!1})}function s(){return o.getSectionTranslations("modals").then(function(e){c=e})}function l(e){n.deleteCreditCard(e.id).then(function(e){e?i():s().then(function(){a.notice(c.default_notice,c.default_ok)})})}var c,u=this;u.creditCards=[],u.loadingCreditCards=!0,i(),u.confirmDeleteCreditCard=function(e){s().then(function(){a.confirm(c.default_confirm,c.default_yes,c.default_no).then(function(){l(e)})})},u.goToAddACard=function(){t.go(r.merchant.settings.children.payment.children.addcard.name)}}]),app.constant("PLANS",{STATUS:{CHOOSING_PM_UPGRADE:0,ADDING_PAYMENT_METHOD:1,REVIEW_AND_CONFIRM:2,CHOOSING_PM_DOWNGRADE:3,DOWNGRADING_TO_BASIC:4},ENDPOINTS:{SUBSCRIPTION_LIST:"/subscriptions",CURRENT_SUBSCRIPTION:"/subscriptions/stores/%s/current",RECEIPTS:"/subscriptions/stores/%s/receipts",SUBSCRIBE:"/subscriptions/stores/%s",PENDING_SUBSCRIPTION:"/subscriptions/stores/%s/future"},TRIAL_PLAN_ID:1,ERROR_TITLE:"Subscriptions error:",ERROR_PRIORITY:1,STORE_EXPIRED_STATUS:3,CARD_TYPES:{VSA:"VISA",MSC:"MASTERCARD",MAE:"MAESTRO",AMX:"AMEX",UNKNOWN:"UNKNOWN"},CHANGED_PLAN_EVENT:"CHANGED_PLAN",MILLISECONDS_PER_DAY:864e5}),app.controller("PlansController",["plansSrv","modalSrv","translationsSrv",function(e,t,r){function n(){a.loading=!0,e.getPlans().then(function(e){a.loading=!1,a.plans=e.allPlans,a.activePlan=e.activePlan,a.plans||r.getSectionTranslations("modals").then(function(e){t.notice(e.default_notice,e.default_ok)})})}var a=this;a.activePlan={},a.loadingPlans=!1,a.loading=!1,a.translations={},n(),r.getSectionTranslations("subscription").then(function(e){a.translations=e}),a.changeToPlan=function(e){t.open("merchant/settings/plans/change_plan.html","ChangePlanController","changePlan","change-plan-modal",{options:function(){return{allPlans:a.plans,plan:e,oldPlan:a.activePlan,callback:n}}})}}]),app.service("plansSrv",["$q","$http","PLANS","userInfoSrv","publicDataSrv","BLOOMBEES_API_URL",function(e,t,r,n,a,o){function i(){var t=e.defer();return g&&v?t.resolve():n.getUserInfo().then(function(e){var r=e.store,n=e.user,a=n.User_subscription_data;g=r.Store_id,b=r.Store_status,a&&a.length&&(v=a[0].StoreFreeTrial_ExpirationDate),t.resolve()}),t.promise}function s(){var n=e.defer();return i().then(function(){t.get(o+r.ENDPOINTS.CURRENT_SUBSCRIPTION.replace("%s",g)).then(function(e){var t;e.data&&e.data.data&&e.data.data.subscription&&(t=e.data.data.subscription,n.resolve(t.idSubscription))})}),n.promise}function l(){var n=e.defer();return i().then(function(){t.get(o+r.ENDPOINTS.PENDING_SUBSCRIPTION.replace("%s",g)).then(function(e){var t,r,a=null;e.data&&e.data.data&&(t=e.data.data.subscriptions,t&&t.length&&(r=t[0],a={idSubscription:r.idSubscription,dateFrom:r.dateFrom}),n.resolve(a))})}),n.promise}function c(e,t){var n,a,o,i;return e.idSubscription!==r.TRIAL_PLAN_ID?null:(n=new Date(t),i=new Date,a=n-i,o=a/r.MILLISECONDS_PER_DAY,Math.max(o,0).toFixed(0))}function u(e){var t=new Date(e);return t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()}function d(){function n(e,t){var r=null;s().then(function(n){l().then(function(o){e.forEach(function(e){var i;Number(e.idSubscription)===Number(n)&&(r=e),o&&(e.disableButton=!0,Number(e.idSubscription)===Number(o.idSubscription)?(e.isFuturePlan=!0,e.dateFrom=u(o.dateFrom)):e.isFuturePlan=!1),i=c(e,t),i&&(e.daysLeft=i),e.frequencyDays||(e.frequencyDays=Number.POSITIVE_INFINITY),e.currencySymbol=a.getCurrencySymbol(e.isoCurrency)}),d.resolve({allPlans:e,activePlan:r})})})}var d=e.defer();return i().then(function(){t.get(o+r.ENDPOINTS.SUBSCRIPTION_LIST).then(function(e){var t;e.data&&(t=e.data.subscription||e.data.data.subscription,n(t,v))})}),d.promise}function p(){var n=e.defer();return i().then(function(){t.get(o+r.ENDPOINTS.RECEIPTS.replace("%s",g)).then(function(e){var t;e.data&&e.data.data&&e.data.data.receipt&&(t=e.data.data.receipt,t.forEach(function(e){e.amount=e.amount+e.isoCurrency,e.taxAmount=e.taxAmount+e.isoCurrency,e.totalAmount=e.totalAmount+e.isoCurrency,e.date=u(e.dateInsert)}),n.resolve(t))})}),n.promise}function f(n,a,s,l){var c={idSubscription:n,idCreditCard:a,maskedCardNumber:s,cardType:l},u=e.defer();return i().then(function(){t.post(o+r.ENDPOINTS.SUBSCRIBE.replace("%s",g),c).then(function(e){e.data&&e.data.success?u.resolve(!0):u.reject(e.data)},function(e){u.reject(e)})}),u.promise}function m(){return s().then(function(e){return Number(e)===r.TRIAL_PLAN_ID})}function h(){return i().then(function(){return Number(b)===r.STORE_EXPIRED_STATUS})}var g,b,v;return{getPlans:d,getReceipts:p,subscribe:f,isTrialPeriodActive:m,isStoreExpired:h}}]),app.constant("PERSONAL_DETAILS",{GENDER:{MALE:"0",FEMALE:"1"},MAX_AGE:100,ENDPOINT:"/manage/users/%s/details"}),app.controller("PersonalDetailsController",["personalDetailsSrv","publicDataSrv","PERSONAL_DETAILS","modalSrv","$q",function(e,t,r,n,a){var o=this;o.loading=!1,o.error=!1,o.genders=r.GENDER,o.years=t.getYears(-r.MAX_AGE),o.months=t.getMonths(),o.days=t.getDays(o.months[0]),o.timezones=[],o.countries=[],o.currencies=[],o.personalInfo={User_gender:null,birthDate:{year:o.years[0],month:o.months[0],day:o.days[0]}},o.updateDays=function(){var e,r=o.personalInfo.birthDate.day;o.days=t.getDays(o.personalInfo.birthDate.month),e=o.days.indexOf(r),e===-1&&(e=0),o.personalInfo.birthDate.day=o.days[e]},o.save=function(){o.loading=!0,e.savePersonalDetails(o.personalInfo).then(function(e){o.loading=!1,e?o.personalInfo=e:(o.error=!0,n.defaultNotice())},function(){o.error=!0,o.loading=!1,n.defaultNotice()})},function(){var r,i,s,l;o.loading=!0,r=e.getPersonalDetails().then(function(e){e?o.personalInfo=e:(o.error=!0,n.defaultNotice())},function(){o.error=!0,n.defaultNotice()}),i=t.getCountries().then(function(e){o.countries=e}),s=t.getCurrencies().then(function(e){o.currencies=e}),l=t.getTimezones().then(function(e){o.timezones=e}),a.all([r,i,s,l]).then(function(){o.loading=!1},function(){o.loading=!1})}()}]),app.service("personalDetailsSrv",["$q","$http","PERSONAL_DETAILS","BLOOMBEES_API_URL","USER_ID",function(e,t,r,n,a){function o(e){var t=e.split("-");return{day:Number(t[2]),month:Number(t[1]),year:Number(t[0])}}function i(){return t.get(n+r.ENDPOINT.replace("%s",a)).then(function(e){var t=null;return e.data.data&&(t=e.data.data,t.User_birthday?t.birthDate=o(t.User_birthday):t.birthDate={}),t})}function s(e){var i,s,l,c={User_avatar:e.User_avatar,User_fullName:e.User_fullName,User_email:e.User_email,User_gender:Number(e.User_gender),User_phone:e.User_phone,User_mobile:e.User_mobile,User_timezone:Number(e.User_timezone),User_countryIsoCode:e.User_countryIsoCode,User_currencyIsoCode:e.User_currencyIsoCode};return e.birthDate.year&&e.birthDate.month&&e.birthDate.day&&(i=e.birthDate.day,s=e.birthDate.month,Number(i)<10&&(i="0"+i),Number(s)<10&&(s="0"+s),l=i+"-"+s+"-"+e.birthDate.year,c.User_birthday=l),t.put(n+r.ENDPOINT.replace("%s",a),c).then(function(e){var t=null;return e.data.data&&(t=e.data.data,t.User_birthday?t.birthDate=o(t.User_birthday):t.birthDate={}),t})}return{getPersonalDetails:i,savePersonalDetails:s}}]),app.constant("SECURITY",{MIN_LENGTH:8,MAX_LENGTH:32,ENDPOINT:"/manage/users/%s/changePassword"}),app.controller("SecurityController",["securitySrv","SECURITY","modalSrv",function(e,t,r){var n=this;n.constants=t,n.password="",n.oldPassword="",n.loading=!1,this.save=function(){n.loading=!0,e.save(n.oldPassword,n.password).then(function(e){n.loading=!1,e.success?r.notice("Password changed successfully","Ok"):r.defaultNotice()},function(e){400===e.data.status&&(n.loading=!1,r.notice("The old password you specified is incorrect","Ok"))})}}]),app.service("securitySrv",["$q","$http","SECURITY","USER_ID","BLOOMBEES_API_URL",function(e,t,r,n,a){return{save:function(e,o){var i={User_passwordOld:e,User_passwordNew:o};return t.post(a+r.ENDPOINT.replace("%s",n),i).then(function(e){return{success:e.data.success,status:e.data.status}})}}}]),app.controller("PaymentInfoController",["$scope","modalSrv",function(e,t){}]),app.constant("STOREFRONT_DETAILS",{ENDPOINT:"/manage/promoters/%s/storeFront"}),app.controller("StorefrontDetailsController",["storefrontDetailsSrv","LANGUAGES","modalSrv",function(e,t,r){var n=this;n.languages=t,n.loading=!1,n.error=!1,n.webAddress="",n.storefrontInfo={Store_description:"",Store_name:"",Store_languageIsoCode:null},n.save=function(){n.loading=!0,e.saveStorefrontDetails(n.storefrontInfo).then(function(e){n.loading=!1,e?n.storefrontInfo=e:r.defaultNotice()},function(){n.loading=!1,r.defaultNotice()})},function(){n.loading=!0,e.getStorefrontDetails().then(function(e){n.loading=!1,n.storefrontInfo=e},function(){n.loading=!1,n.error=!0,r.defaultNotice()})}()}]),app.service("storefrontDetailsSrv",["$q","$http","STOREFRONT_DETAILS","STORE_ID","BLOOMBEES_API_URL",function(e,t,r,n,a){function o(){return t.get(a+r.ENDPOINT.replace("%s",n)).then(function(e){var t=null;return e.data.data&&(t=e.data.data),t})}function i(e){return t.put(a+r.ENDPOINT.replace("%s",n),e).then(function(e){var t=null;return e.data.success&&e.data.data&&(t=e.data.data),t})}return{getStorefrontDetails:o,saveStorefrontDetails:i}}]),app.component("visualizeCreditCard",{templateUrl:"partials/visualize_credit_card.html",bindings:{creditCard:"<"},controllerAs:"visualizeCreditCardController"}),app.controller("ChangePlanController",["$rootScope","$q","$scope","PLANS","plansSrv","creditCardSrv","modalSrv","translationsSrv","options",function(e,t,r,n,a,o,i,s,l){function c(){var e,t;return p.selectedPlan?(Number(p.selectedPlan.idSubscription)===n.TRIAL_PLAN_ID?e=p.STATUS.DOWNGRADING_TO_BASIC:(t=p.oldPlan.price>p.selectedPlan.price||p.oldPlan.price===p.selectedPlan.price&&p.oldPlan.frequencyDays<p.selectedPlan.frequencyDays,e=t?p.STATUS.CHOOSING_PM_DOWNGRADE:p.STATUS.CHOOSING_PM_UPGRADE),e):null}function u(){var e=t.defer();return Object.keys(p.translations).length?e.resolve(p.translations):s.getSectionTranslations("subscription").then(function(t){s.getSectionTranslations("modals").then(function(r){p.translations=angular.extend({},r,t),e.resolve(p.translations)})}),e.promise}var d,p=this;p.creditCards=[],p.STATUS=n.STATUS,p.currentStatus=p.STATUS.CHOOSING_PM_UPGRADE,p.loading=!1,p.closeThisDialog=r.closeThisDialog,p.translations={},p.initialStatus=c(),p.cancelAddPaymentMethod=function(){p.goToInitialStatus()},p.goToCreditCardForm=function(){p.currentStatus=p.STATUS.ADDING_PAYMENT_METHOD},p.goToReviewAndConfirm=function(){p.currentStatus=p.STATUS.REVIEW_AND_CONFIRM},p.goToInitialStatus=function(){p.initialStatus=c(),p.currentStatus=p.initialStatus},p.goBack=function(){p.currentStatus===p.STATUS.DOWNGRADING_TO_BASIC?p.closeThisDialog():p.goToInitialStatus()},p.addPaymentMethod=function(e){o.createCreditCard(e).then(function(e){p.goToInitialStatus(),p.creditCards.push(e),p.selectedCreditCard=e})},p.onPlanChange=function(){p.goToInitialStatus()},p.confirm=function(){var t,r,o,s=p.selectedPlan.idSubscription;p.currentStatus!==p.STATUS.DOWNGRADING_TO_BASIC&&(t=Number(p.selectedCreditCard.fapi_id),r=p.selectedCreditCard.maskedNumber,o=n.CARD_TYPES[p.selectedCreditCard.brand]||n.CARD_TYPES.UNKNOWN),p.loading=!0,u().then(function(){a.subscribe(s,t,r,o).then(function(t){t&&(p.loading=!1,d(p.selectedPlan),p.closeThisDialog(),i.notice(p.translations.message_thanks+"\n"+p.selectedPlan.name,p.translations.default_ok),e.$emit(n.CHANGED_PLAN_EVENT,s))},function(){p.loading=!1,p.closeThisDialog(),i.notice(p.translations.default_notice,p.translations.default_ok)})})},function(){d=l.callback||angular.noop,p.selectedPlan=l.plan,p.oldPlan=l.oldPlan,p.allPlans=l.allPlans.filter(function(e){return e.idSubscription!==p.oldPlan.idSubscription}),p.goToInitialStatus(),o.getCreditCards().then(function(e){p.creditCards=e,p.creditCards.length&&(p.selectedCreditCard=p.creditCards[0])}),u()}()}]),app.constant("PLANS_RECEIPTS",{RECEIPTS_COLUMNS:[{name_tag:"title_date",flex:20,field:"date"},{name_tag:"title_receipt",flex:30,field:"idReceipt"},{name_tag:"title_reason",flex:40,field:"receiptName"},{name_tag:"title_price",flex:10,field:"amount"}]}),app.controller("ReceiptsController",["$q","$state","PLANS_RECEIPTS","BB_TABLE","ROUTES","plansSrv","translationsSrv",function(e,t,r,n,a,o,i){var s=this;s.receiptsColumns=r.RECEIPTS_COLUMNS,s.translations={},s.loadReceipts=function(e,t){return o.getReceipts().then(function(r){return r.sort(function(r,n){var a=t;return r[e]>n[e]&&(a=-a),a})})},s.goToDetail=function(e){t.go(a.merchant.settings.children.plans.children.plansreceipts.children.receiptdetail.name,{id:e.idReceipt})},i.getSectionTranslations("subscription").then(function(e){s.translations=e,s.receiptsColumns.forEach(function(e){e.name=s.translations[e.name_tag]})})}]),app.controller("ReceiptDetailController",["plansSrv","$stateParams","$q","translationsSrv","$state","ROUTES",function(e,t,r,n,a,o){var i,s,l=this;l.receipt={billingAddress:{}},l.loading=!0,l.translations={},l.backToReceipts=function(){a.go(o.merchant.settings.children.plans.children.plansreceipts.name)},i=e.getReceipts().then(function(e){var r=t.id,n=null;e.forEach(function(e){e.idReceipt===r&&(n=e)}),n?l.receipt=n:l.backToReceipts()}),s=n.getSectionTranslations("subscription").then(function(e){l.translations=e}),r.all([i,s]).then(function(){l.loading=!1})}]),app.component("bankAccountInfo",{replace:!0,restrict:"E",templateUrl:"partials/influencer/payment_info/bank_account_info.html",controllerAs:"bankAccountInfoController",controller:["$scope","modalSrv","bankAccountService","$q",function(e,t,r,n){function a(){i.loaded=!1,r.getInfo().then(function(e){i.account=e,i.alreadySet=null!==e,i.loaded=!0,i.alreadySet&&(i.maskedIban=r.maskIban(e.Bank_accountNumber))},function(){i.loaded=!0,t.notice("Something went wrong","Ok")})}function o(){return a(),n.resolve()}var i=this;i.alreadySet=!1,i.loaded=!1,i.account={},i.openBankModal=function(e){var r=e||null;t.open("partials/influencer/payment_info/bank_config_modal.html","bankConfigModalController","bankConfigModal","bank-config-modal-container",{bankConfigCallback:function(){return o},bankAccountId:function(){return r}})},i.editBankAccount=function(){i.openBankModal(i.account.Bank_id)},i.removeBankAccount=function(){t.confirm("Are you sure?","Yes","No").then(function(){r.deleteBankAccount(i.account.Bank_id).then(function(e){e?a():t.defaultNotice()},t.defaultNotice)})},a()}]}),app.constant("BANK_ACCOUNT",{ENDPOINTS:{BANK_ACCOUNT_INFO:"/manage/bankAccounts/"}}),app.service("bankAccountService",["$q","modalSrv","$http","USER_ID","STORE_ID","BLOOMBEES_API_URL","BANK_ACCOUNT",function(e,t,r,n,a,o,i){function s(e){return"**** "+e.substring(e.length-4,e.length)}function l(){return r.get(o+i.ENDPOINTS.BANK_ACCOUNT_INFO+a).then(function(e){var t=null,r=[];return e.data&&e.data.data&&(r=e.data.data.BankAccounts,r.length&&(t=r[0])),t})}function c(e){return r.get(o+i.ENDPOINTS.BANK_ACCOUNT_INFO+a+"/"+e).then(function(e){var t=null;return e.data&&e.data.data&&(t=e.data.data.BankAccount),t})}function u(e){return r.put(o+i.ENDPOINTS.BANK_ACCOUNT_INFO+a,e).then(function(e){return 200===e.data.status||201===e.data.status})}function d(e){return r.post(o+i.ENDPOINTS.BANK_ACCOUNT_INFO+a,e).then(function(e){return 200===e.data.status||201===e.data.status})}function p(e,t){return t?u(e):d(e)}function f(e){return r.delete(o+i.ENDPOINTS.BANK_ACCOUNT_INFO+a+"/"+e).then(function(e){return 200===e.data.status})}return{getInfo:l,editBankAccount:u,submitBankAccount:p,deleteBankAccount:f,getFullInfo:c,maskIban:s}}]),app.constant("BLOOMBEES_MASTERCARD",{ENDPOINTS:{STATUS:"/payoneer/userinfo/",ACTIVATE:"/payoneer/create/",DISABLE:"/payoneer/unactive/",RE_ENABLE:"/payoneer/active/"},STATUS_CODES:{UNUSED:0,INITIATED:1,PENDING:2,ACTIVE:3,INACTIVE:4,DENIED:5}}),app.directive("bloombeesMastercard",function(){return{replace:!0,restrict:"E",templateUrl:"partials/influencer/payment_info/bloombees_mastercard.html",controllerAs:"bbMastercard",controller:["$http","modalSrv","BLOOMBEES_API_URL","STORE_ID","BLOOMBEES_MASTERCARD",function(e,t,r,n,a){function o(){return e.get(i).then(function(e){var t,r=e.data?e.data.data:null;r&&(d.status=Number(r.User_payoneerStatus),d.status===u.INITIATED&&(d.resumeUrl=r.User_payoneerUrl),d.status===u.ACTIVE&&(t=r.User_payoneerProfileInfo?r.User_payoneerProfileInfo[0]:null)&&(d.email=t.Profile_email),d.loaded=!0)},function(){t.notice("For some reasons, we could not establish a connection with Payoneer to enable your account. Please, try again later or contact support@bloombees.com","Ok")})}var i=r+a.ENDPOINTS.STATUS+n,s=r+a.ENDPOINTS.ACTIVATE+n,l=r+a.ENDPOINTS.DISABLE+n,c=r+a.ENDPOINTS.RE_ENABLE+n,u=a.STATUS_CODES,d=this;d.STATUS_CODE=u,d.status=u.UNUSED,d.email="",d.resumeUrl=null,d.loaded=!1,d.activate=function(){d.status===u.UNUSED?t.confirm("To request your Bloombees MasterСard®, you will be redirected to the website of our partner Payoneer. Would you like to proceed?","Yes","No").then(function(){e.post(s).then(function(e){var r=e.data?e.data.data:null;r?(window.open(r.User_payoneerUrl),o()):t.defaultNotice()})}):d.status===u.INACTIVE&&e.put(c).then(o)},d.resume=function(){d.status===u.INITIATED&&d.resumeUrl&&window.open(d.resumeUrl)},d.disable=function(){d.status!==u.UNUSED&&d.status!==u.INITIATED&&t.confirm("Are you sure?","",function(){e.put(l).then(o)})},function(){o()}()}]}}),app.controller("bankConfigModalController",["$timeout","modalSrv","bankAccountService","publicDataSrv","bankConfigCallback","bankAccountId",function(e,t,r,n,a,o){function i(){return n.getCountries().then(function(e){s.countries=e,s.countries.length&&!s.account.Bank_countryIsoCode&&n.getGeo().then(function(e){s.account.Bank_countryIsoCode=e.COUNTRY})})}var s=this,l=a||angular.noop;s.ADDRESS_MAX_CHARACTERS=70,s.countries=[],s.loading=!1,s.account={},s.saveAccount=function(){var e=null!==o,n={Bank_name:s.account.Bank_name,Bank_accountHolderName:s.account.Bank_accountHolderName,Bank_accountNumber:s.account.Bank_accountNumber,Bank_swiftCode:s.account.Bank_swiftCode,Bank_accountAddress:s.account.Bank_accountAddress,Bank_accountAddressCity:s.account.Bank_accountAddressCity,Bank_accountAddressState:s.account.Bank_accountAddressState,Bank_accountAddressZipCode:s.account.Bank_accountAddressZipCode,Bank_countryIsoCode:s.account.Bank_countryIsoCode};s.loading=!0,r.submitBankAccount(n,e).then(function(e){s.loading=!1,e?(l(),t.closeAll()):t.defaultNotice()},function(){s.loading=!1,t.defaultNotice()})},s.close=function(){t.closeAll()},function(){i(),o&&(s.loading=!0,r.getFullInfo(o).then(function(e){s.account=e,s.loading=!1}))}()}]),app.constant("MOCKDATA_URL","http://localhost:9085/dev_api?file="),app.controller("BuyerDashboardController",["buyerDashboardService","userInfoSrv",function(e,t){var r=this;r.dashboardData=[],t.get("mockdata/userData.json").then(function(e){r.dashboardData=e.data.productsLike})}]),app.service("buyerDashboardService",["$http","MOCKDATA_URL",function(e,t){this.getBuyerDashboardData=function(){return e({method:"GET",url:t+"buyerDashboardData.json"}).then(function(e){return e.data},function(e){})}}]),app.constant("BALANCE",{ENDPOINTS:{BALANCE_INFO:"/withdrawals/balance/%s/beeViral",WITHDRAWALS_LIST:"/withdrawals/list/",WITHDRAW:"/withdrawals/withdraw/"},CHART:{DATA:{withdrawn:{COLOR:"rgb(22, 145, 183)",LABEL:"payments_title_already_withdrawn",DESCRIPTION:"payments_message_already_withdrawn"},inProcess:{COLOR:"rgb(255, 174, 0)",LABEL:"payments_title_withdrawals_in_process",DESCRIPTION:"payments_message_withdrawals_in_process"},onHold:{COLOR:"rgb(252, 74, 100)",LABEL:"payments_title_amount_on_hold",DESCRIPTION:"payments_message_amount_on_hold"},availableToWithdraw:{COLOR:"rgb(57, 198, 197)",LABEL:"payments_title_available_to_withdraw",DESCRIPTION:"payments_message_available_to_withdraw"}}},TABLE:{COLUMNS:[{name_tag:"payment_title_method",flex:25,field:"Withdrawal_bankAccountNumber"},{name_tag:"payment_title_status",flex:25,field:"Withdrawal_statusCode"},{name_tag:"payment_title_date",flex:25,field:"Withdrawal_dateInserted"},{name_tag:"payment_title_amount",flex:25,field:"Withdrawal_amount"}],ROW_LIMIT:9,LABELS:{ACCOUNT:"beeviral_balance_label_account",CARD:"beeviral_balance_label_card"}},WITHDRAWAL_TYPES:{BANK_TRANSFER:"BANK_TRANSFER"},STATUS_TRANSLATIONS_PREFIX:"payment_title_"}),app.controller("BalanceController",["$q","balanceSrv","translationsSrv","BALANCE","modalSrv",function(e,t,r,n,a){function o(){return r.getSectionTranslations("modals").then(function(e){u=e})}function i(){l.error.chart||l.error.table||o().then(function(){a.notice(u.default_notice,u.default_ok)})}function s(e,t){var r=[n.CHART.DATA.withdrawn.COLOR,n.CHART.DATA.inProcess.COLOR,n.CHART.DATA.onHold.COLOR,n.CHART.DATA.availableToWithdraw.COLOR],a=angular.element("#promoterBalanceChart"),o={labels:t,datasets:[{data:e,backgroundColor:r,hoverBackgroundColor:r}]},i={responsive:!1,maintainAspectRatio:!1,legend:{labels:{generateLabels:function(){return[]}}}};return new Chart(a,{type:"doughnut",data:o,options:i})}var l=this,c=[],u={},d=angular.element("translations")[0];l.loading={chart:!0},l.error={chart:!1,table:!1},l.chartLegend=[],l.totalBalance=0,l.availableToWithdraw=0,l.currency="",l.chartDataStats=n.CHART.DATA,l.translations=d.dataset,l.recentActivityColumns=n.TABLE.COLUMNS.map(function(e){var t=e;return t.name=l.translations[e.name_tag],t}),l.totalRecentActivityItems=0,l.recentActivityRowLimit=n.TABLE.ROW_LIMIT,l.loadRecentActivity=function(r,n,a,o){var s=e.defer();return c.length?s.resolve(c):t.getRecentActivity().then(function(e){var t
;l.totalRecentActivityItems=e.length,t=e.sort(function(e,t){var a=n;return e[r]>t[r]&&(a=-a),a}).slice(a,a+o),s.resolve(t)},function(){i(),l.error.table=!0,s.reject()}),s.promise},function(){t.getBalanceInfo().then(function(e){var t=n.CHART.DATA;l.totalBalance=e.total,l.availableToWithdraw=e.availableToWithdraw,l.currency=e.currency,l.recentActivityColumns[3].currency=l.currency,s([e.withdrawn,e.inProcess,e.onHold,e.availableToWithdraw],[t.withdrawn.LABEL,t.inProcess.LABEL,t.onHold.LABEL,t.availableToWithdraw.LABEL]),l.loading.chart=!1,l.chartLegend=[{label:t.withdrawn.LABEL,value:e.withdrawn,color:t.withdrawn.COLOR},{label:t.inProcess.LABEL,value:e.inProcess,color:t.inProcess.COLOR},{label:t.onHold.LABEL,value:e.onHold,color:t.onHold.COLOR},{label:t.availableToWithdraw.LABEL,value:e.availableToWithdraw,color:t.availableToWithdraw.COLOR}]},function(){i(),l.error.chart=!0})}()}]),app.service("balanceSrv",["$q","$http","userInfoSrv","BALANCE","BLOOMBEES_API_URL","STORE_ID",function(e,t,r,n,a,o){function i(){var t=e.defer();return c?t.resolve():r.getUserInfo().then(function(e){c=e.user.User_symbolCurrency,t.resolve()}),t.promise}function s(){var r=e.defer();return i().then(function(){t.get(a+n.ENDPOINTS.BALANCE_INFO.replace("%s",o)).then(function(e){var t;e.data&&e.data.data?(t=e.data.data,r.resolve({currency:c,availableToWithdraw:Number(t.Promoter_totalAvailableToWithdraw),total:Number(t.Promoter_totalEarnings),withdrawn:Number(t.Promoter_totalWithdrawn),inProcess:Number(t.Promoter_totalWithdrawalsInProcess),onHold:Number(t.Promoter_totalPendingEarnings)})):r.reject()},r.reject)}),r.promise}function l(){var r=e.defer();return i().then(function(){t.get(a+n.ENDPOINTS.WITHDRAWALS_LIST+o).then(function(e){var t;e.data&&e.data.data?(t=e.data.data,t=t.map(function(e){return e.Withdrawal_bankAccountNumber=e.Withdrawal_bankAccountNumber||"",e.Withdrawal_type===n.WITHDRAWAL_TYPES.BANK_TRANSFER?e.Withdrawal_bankAccountNumber=d[n.TABLE.LABELS.ACCOUNT]+" "+e.Withdrawal_bankAccountNumber:e.Withdrawal_bankAccountNumber=d[n.TABLE.LABELS.CARD],e.Withdrawal_statusCode&&(e.Withdrawal_statusCode=d[n.STATUS_TRANSLATIONS_PREFIX+e.Withdrawal_statusCode]),e.Withdrawal_amount=Number(e.Withdrawal_amount),e}),r.resolve(t)):r.reject()},r.reject)}),r.promise}var c,u=angular.element("translations")[0],d={};return u&&(d=u.dataset),{getBalanceInfo:s,getRecentActivity:l}}]),app.constant("INFLUENCER_DASHBOARD",{ENDPOINTS:{API:"/beeViral/dashboard"},INFO_BLOCKS:{affiliateProducts:{iconClass:"dashboard-products",href:"private.influencer.products"},affiliateSales:{iconClass:"dashboard-orders",href:"private.influencer.products"},influencerBalance:{iconClass:"dashboard-sales",href:"private.influencer.balance"}}}),app.controller("InfluencerDashboardCtrl",["$scope","$timeout","$log","influencerDashboardSrv","HELP_CENTER","publicDataSrv","TRANSLATIONS","translationsSrv",function(e,t,r,n,a,o,i,s){var l,c,u,d,p=this;e.helpCenterOptions=a.INFLUENCER,p.titleBlocks={},p.userInfo={},p.chartData=[],l=n.dashboard,c={withSales:l.UserReport.User_promotedProductsCountWithSales,totalProducts:l.UserReport.User_promotedProductsCount,total:{name:s.getTranslationFromElement("dashboard;label_total_products")},mainValue:{name:s.getTranslationFromElement("dashboard;label_have_sales")},name:s.getTranslationFromElement("dashboard;title_affiliate_products")},u={sold:l.UserReport.User_promotedSalesTransactions,viewed:l.UserReport.User_promotedProductsVisits,total:{name:s.getTranslationFromElement("dashboard;label_total_conversion")},mainValue:{name:s.getTranslationFromElement("dashboard;label_sold")},secondValue:{name:s.getTranslationFromElement("dashboard;label_viewed")},name:s.getTranslationFromElement("dashboard;title_affiliate_sales")},d={availableToWithdraw:l.UserReport.User_promoterReadyToWithdrawAmount,totalSales:l.UserReport.User_promoterAlreadyWithdrawnAmount,currency:o.currencyToSymbol(l.UserReport.User_isoCurrency),total:{name:s.getTranslationFromElement("dashboard;label_total_sales")},mainValue:{name:s.getTranslationFromElement("dashboard;label_available_withdraw")},name:s.getTranslationFromElement("dashboard;title_influencer_balance")},p.topProducts=l.TopProductsReport,p.userInfo=l.UserReport,p.currency=o.currencyToSymbol(p.userInfo.User_isoCurrency),p.titleBlocks=n.buildDashboardBlocks(c,u,d),p.socialPerformance=l.SocialNetworksReport,p.chartData=l.SalesReport,p.socialNetworks={}}]),app.service("influencerDashboardSrv",["$resource","$q","INFLUENCER_DASHBOARD","userInfoSrv","translationsSrv","BLOOMBEES_API_URL","USER_ID",function(e,t,r,n,a,o,i){function s(e,t,n){var a={mainValue:{amount:e.withSales,name:e.mainValue.name},total:{amount:e.totalProducts,name:e.total.name},name:e.name},o={mainValue:{amount:t.sold,name:t.mainValue.name},secondValue:{amount:t.viewed,name:t.secondValue.name},total:{amount:(t.sold/t.viewed*100).toFixed(2)+"%",name:t.total.name},name:t.name},i={mainValue:{amount:n.availableToWithdraw,currency:n.currency,name:n.mainValue.name},total:{amount:n.totalSales,currency:n.currency,name:n.total.name},name:n.name};return[angular.merge({},r.INFO_BLOCKS.affiliateProducts,a),angular.merge({},r.INFO_BLOCKS.affiliateSales,o),angular.merge({},r.INFO_BLOCKS.influencerBalance,i)]}function l(){return e(o+r.ENDPOINTS.API+"/:id",{id:i}).get().$promise}function c(){var e=t.defer();return a.getSectionTranslations(r.ENDPOINTS.DICTIONARY).then(function(t){e.resolve(t)}),e.promise}return{getDashboardData:l,buildDashboardBlocks:s,getDashboardTranslations:c}}]),app.constant("INFLUENCER_PERFORMANCE",{ENDPOINTS:{PRODUCTS:"/beeViral/performance/:userId",FILTERS:"/beeViral/performance/:userId"}}),app.controller("InfluencerPerformanceCtrl",["$log","influencerPerformanceSrv","discoverSrv","publicDataSrv","LANGUAGE",function(e,t,r,n,a){var o=this;o.all=[],o.totalEarnings=0,o.lang=a,o.categories=r.categories,o.filters={category:{},search:"",searchString:"",tags:"",tagsArray:[],orderBy:"",offset:0,limit:10,active:{search:!1,tags:!1,order:!1,price:!1,category:!1},price:{active:!1,options:{hidePointerLabels:!0,hideLimitLabels:!0,boundPointerLabels:!1,onEnd:function(e,t,r){o.filters.active.price=o.filters.price.options.floor+o.filters.price.options.ceil!==t+r,o.filters.update()}}},removeTag:function(e){var t=o.filters.tagsArray.indexOf(e);t>-1&&o.filters.tagsArray.splice(t,1),o.filters.tags=o.filters.tagsArray.join(", "),o.filters.update()},clearSearch:function(e){o.filters.search="",o.filters.searchString="",o.filters.active.search=!1,!e&&o.filters.update()},resetPriceRange:function(e){o.filters.price.min=o.filters.price.options.floor,o.filters.price.max=o.filters.price.options.ceil,o.filters.active.price=!1,!e&&o.filters.update()},resetAll:function(){o.filters.tags="",o.filters.tagsArray.length=0,o.filters.active.tags=!1,o.filters.category={},o.filters.active.category=!1,o.filters.clearSearch(!0),o.filters.resetOrder(!0),o.filters.resetPriceRange(!0),o.getProducts(0,o.filters.currentLimit)},resetOrder:function(e){o.filters.orderBy="",o.filters.active.order=!1,!e&&o.filters.update()},update:function(){var e={};o.filters.active.search&&(e.search=o.filters.search),o.filters.active.order&&(e.order=o.filters.orderBy),o.filters.active.price&&(e.priceMin=o.filters.price.min,e.priceMax=o.filters.price.max),o.filters.active.tags&&(e.tags=o.filters.tags),angular.equals(o.filters.category,{})||(e.cat=o.filters.category.TagCat_id),o.getProducts(0,o.filters.currentLimit,e)},isActive:function(){return""!==o.filters.searchString||o.filters.tagsArray.length>0||"date"!==o.filters.orderBy&&""!==o.filters.orderBy||o.filters.active.price||!angular.equals(o.filters.category,{})}},o.filters.currentLimit=o.filters.limit+o.filters.offset,o.renderPrice=function(e){return parseFloat(Number(e).toFixed(2))},o.setFiltersData=function(e){var t=e.map(function(e){return o.totalEarnings+=e.Performance_totalEarned,e.Product_price}),r=0===e.length?0:Math.floor(Math.min.apply(Math,t)),n=0===e.length?0:Math.ceil(Math.max.apply(Math,t));o.filters.currency=o.filters.currency||e[0].Performance_currencySymbol,o.all.length>0&&(o.filters.currency=o.all[0].Performance_currencySymbol),o.filters.active.price||(o.filters.price.min=r,o.filters.price.max=n,o.filters.price.options.floor=o.filters.price.min!==o.filters.price.max?o.filters.price.min:0,o.filters.price.options.ceil=n),o.isLoadingProducts=!1,o.firstLoad=!1},o.getProducts=function(e,r,n){o.all.length=0,o.firstLoad=!0,o.isLoadingProducts=!0,n&&!angular.equals({},n)?t.filterProducts(n).then(function(e){e.success&&200===e.status&&(o.all=e.data.PromoterPerformance,o.totalEarnings=0),o.setFiltersData(o.all)}):t.getProducts().then(function(e){e.success&&200===e.status&&(o.all=e.data.PromoterPerformance,o.totalEarnings=0),o.setFiltersData(o.all)})},o.getProducts(0,o.filters.currentLimit)}]),app.service("influencerPerformanceSrv",["$resource","INFLUENCER_PERFORMANCE","USER_ID","BLOOMBEES_API_URL",function(e,t,r,n){var a=this;a.getProducts=function(){return e(n+t.ENDPOINTS.PRODUCTS,{userId:r}).get().$promise},a.filterProducts=function(a){var o={userId:r};return Object.keys(a).forEach(function(e){o[e]=a[e]}),e(n+t.ENDPOINTS.FILTERS,o).get().$promise}}]),app.constant("INFLUENCER_STOREFRONT",{ENDPOINTS:{PRODUCTS:"/beeViral/storefront/products/:userId",FILTERS:"/beeViral/storefront/products/:userId",DELETE:"/beeViral/storefront/products/:userId/:productId",DRAG:"/beeViral/storefront/products/:userId"}}),app.controller("InfluencerStorefrontCtrl",["$log","$scope","$state","$timeout","$document","userInfoSrv","localStorageService","ngDialog","influencerStorefrontSrv","publicDataSrv","modalSrv","discoverSrv","LANGUAGE","ROUTES",function(e,t,r,n,a,o,i,s,l,c,u,d,p,f){var m=this;m.getObjectValue=function(e,t){return t.split(".").reduce(function(e,t){return void 0===e||null===e?e:e[t]},e)},m.lang=p,m.isLoadingProducts=!1,m.localData=i.get("app"),m.all=[],m.activeLayout=m.getObjectValue(m.localData,"influencer.settings.storefront.layout")||"grid",m.gridSize="",m.filters={deletedProducts:0,size:"1",category:"",search:"",searchString:"",tags:"",tagsArray:[],orderBy:"",offset:0,limit:15,active:{search:!1,tags:!1,order:!1,price:!1,category:!1},price:{active:!1,options:{hidePointerLabels:!0,hideLimitLabels:!0,boundPointerLabels:!1,onEnd:function(e,t,r){m.filters.active.price=m.filters.price.options.floor+m.filters.price.options.ceil!==t+r,m.filters.update()}}},removeTag:function(e){var t=m.filters.tagsArray.indexOf(e);t>-1&&m.filters.tagsArray.splice(t,1),m.filters.tags=m.filters.tagsArray.join(", "),m.filters.update()},clearSearch:function(e){m.filters.search="",m.filters.searchString="",m.filters.active.search=!1,!e&&m.filters.update()},resetPriceRange:function(e){m.filters.price.min=m.filters.price.options.floor,m.filters.price.max=m.filters.price.options.ceil,m.filters.active.price=!1,!e&&m.filters.update()},resetAll:function(){m.filters.tags="",m.filters.tagsArray.length=0,m.filters.active.tags=!1,m.filters.category="",m.filters.active.category=!1,m.filters.clearSearch(!0),m.filters.resetOrder(!0),m.filters.resetPriceRange(!0),m.getProducts(0,m.filters.currentLimit)},resetOrder:function(e){m.filters.orderBy="",m.filters.active.order=!1,!e&&m.filters.update()},update:function(){var e={};m.filters.active.search&&(e.search=m.filters.search),m.filters.active.order&&(e.order=m.filters.orderBy),m.filters.active.price&&(e.priceMin=m.filters.price.min,e.priceMax=m.filters.price.max),m.filters.active.tags&&(e.tags=m.filters.tags),""!==m.filters.category&&(e.cat=m.filters.category.TagCat_id),m.getProducts(0,m.filters.currentLimit,e)},isActive:function(){return""!==m.filters.searchString||m.filters.tagsArray.length>0||"date"!==m.filters.orderBy&&""!==m.filters.orderBy||m.filters.active.price||m.filters.category&&""!==m.filters.category}},m.filters.currentLimit=m.filters.limit+m.filters.offset,m.categories=d.categories,m.dragoverCallback=function(e){return e<m.currentItemDndIndex||e>m.currentItemDndIndex+1},m.dragstartCallback=function(e){var r=angular.element(event.target);m.filters.isActive()?(t.$emit("alert",{type:"error",message:"noDrag"}),event.preventDefault(),n(function(){r.removeClass("dndDraggingSource"),r.removeClass("dndDragging"),r.attr("draggable","false")})):m.currentItemDndIndex=e},m.dropCallback=function(e,r){var a;return l.dragProduct(r.Product_bbcode,e).then(function(e){if(!e.success){for(n(function(){t.$emit("alert",{type:"error",message:"defaultError"})}),a=0;a<m.all.length;a++)if(m.all[a].Product_bbcode===r.Product_bbcode){m.all.splice(a,1);break}m.all.splice(m.currentItemDndIndex,0,r)}}),r},m.getActiveTemplate=function(){return"partials/storefront-"+m.activeLayout+".html"},m.setProductsLayout=function(e){var t=m.localData||{},r=t.influencer||{},n=r.settings||{},a=n.storefront||{};m.activeLayout=e,t.influencer=r,t.influencer.settings=n,t.influencer.settings.storefront=a,t.influencer.settings.storefront.layout=e,i.set("app",t)},m.setProductImage=function(e){return{backgroundImage:"url("+e+")"}},m.setFiltersData=function(e){var t=e.map(function(e){return e.Product_price}),r=0===e.length?0:Math.floor(Math.min.apply(Math,t)),n=0===e.length?0:Math.ceil(Math.max.apply(Math,t));m.filters.currency=m.filters.currency||c.currencyToSymbol(e[0].Product_isoCurrency),m.filters.active.price||(m.filters.price.min=r,m.filters.price.max=n,m.filters.price.options.floor=m.filters.price.min!==m.filters.price.max?m.filters.price.min:0,m.filters.price.options.ceil=n)},m.getComission=function(e,t){return(Math.round(e*t)/100).toFixed(2)},m.shareAndEarn=function(e){u.shareAndEarn(e)},m.showOnPerformance=function(e){r.go(f.influencer.performance.name)},m.loadMore=function(){m.filters.offset+=m.filters.currentLimit,m.isLoadingProducts=!0,l.getProducts(m.filters.offset,m.filters.limit+m.filters.deletedProducts).then(function(e){m.isLoadingProducts=!1,m.all=m.all.concat(e.data.Products),m.setFiltersData(m.all),m.filters.currentLimit=m.filters.limit+m.filters.offset,m.filters.deletedProducts=0})},m.updateGrid=function(){m.filters.limit=15,"1"===m.filters.size?(m.gridSize="medium",m.filters.limit=12):"2"===m.filters.size&&(m.gridSize="large",m.filters.limit=9)},m.deleteProduct=function(e){u.confirm().then(function(){l.deleteProduct(e).then(function(r){r.success?(m.all=m.all.filter(function(t){return t.Product_id!==e}),m.filters.currentLimit--,m.filters.deletedProducts++):t.$emit("alert",{type:"error",message:"defaultError"})})})},m.getProducts=function(e,t,r){m.all.length=0,m.firstLoad=!0,m.isLoadingProducts=!0,r&&!angular.equals({},r)?l.filterProducts(r).then(function(e){e.success&&200===e.status&&(m.all=e.data.Products),m.setFiltersData(m.all),m.isLoadingProducts=!1,m.firstLoad=!1},function(){m.isLoadingProducts=!1,m.firstLoad=!1}):l.getProducts(e,t).then(function(e){m.promoterUrl=e.data.Promoter_url,e.success&&200===e.status&&(m.all=e.data.Products),m.setFiltersData(m.all),m.isLoadingProducts=!1,m.firstLoad=!1},function(){m.isLoadingProducts=!1,m.firstLoad=!1})},m.getProducts(0,m.filters.currentLimit)}]),app.service("influencerStorefrontSrv",["$log","userInfoSrv","$resource","INFLUENCER_STOREFRONT","BLOOMBEES_API_URL","USER_ID",function(e,t,r,n,a,o){var i=this;i.getProducts=function(e,t){return r(a+n.ENDPOINTS.PRODUCTS,{userId:o,limit:t,offset:e}).get().$promise},i.deleteProduct=function(e){return r(a+n.ENDPOINTS.DELETE,{userId:o,productId:e}).remove().$promise},i.dragProduct=function(e,t){return r(a+n.ENDPOINTS.DRAG,{userId:o,id:e,position:t}).save().$promise},i.filterProducts=function(e){var t={userId:o};return Object.keys(e).forEach(function(r){t[r]=e[r]}),r(a+n.ENDPOINTS.FILTERS,t).get().$promise}}]),app.constant("MERCHANT_DASHBOARD",{INFO_BLOCKS:{products:{name:"Products",mainValue:{name:"Active"},secondValue:{name:"Out of Stock"},total:{name:"Total Products"},iconClass:"dashboard-products",href:"private.merchant.products"},orders:{name:"Orders",mainValue:{name:"To process"},secondValue:{name:"To refund"},total:{name:"Total Orders"},iconClass:"dashboard-orders",href:"private.merchant.orders.process"},balance:{name:"Balance",mainValue:{name:"To withdraw"},secondValue:{name:"Pending"},total:{name:"Total Sales"},iconClass:"dashboard-sales",href:"private.merchant.balance"}}}),app.controller("MerchantDashboardCtrl",["$scope","$log","$timeout","userInfoSrv","HELP_CENTER","MERCHANT_DASHBOARD",function(e,t,r,n,a,o){var i=this;e.helpCenterOptions=a.MERCHANT,i.titleBlocks={},i.labels=[],i.data=[],n.get("mockdata/userData.json").then(function(e){n.current=e.data,i.chartsData=e.data.sales,i.topProducts=e.data.stock,i.titleBlocks=[angular.merge({},o.INFO_BLOCKS.products,{mainValue:{amount:e.data.products.active},secondValue:{amount:e.data.products.outOfStock},total:{amount:e.data.products.active+e.data.products.outOfStock}}),angular.merge({},o.INFO_BLOCKS.orders,{mainValue:{amount:e.data.orders.process},secondValue:{amount:e.data.orders.refund},total:{amount:e.data.orders.process+e.data.orders.refund}}),angular.merge({},o.INFO_BLOCKS.balance,{mainValue:{amount:e.data.balance.withdraw,currency:"€"},secondValue:{amount:e.data.balance.pending,currency:"€"},total:{amount:e.data.balance.withdraw+e.data.balance.pending,currency:"€"}})]})}]),app.controller("MerchantProductsCtrl",["$log","$scope","$timeout","$document","userInfoSrv","localStorageService","ngDialog",function(e,t,r,n,a,o,i){var s=this;s.getObjectValue=function(e,t){return t.split(".").reduce(function(e,t){return void 0===e||null===e?e:e[t]},e)},s.isLoadingProducts=!1,s.localData=o.get("app"),s.all=[],s.activeLayout=s.getObjectValue(s.localData,"merchant.settings.products.layout")||"grid",s.gridSize="",s.actionsPopoverId="",s.categories=[],s.filters={size:"0",search:"",searchString:"",tags:"",tagsArray:[],orderBy:"",offset:0,limit:15,active:{search:!1,tags:!1,order:!1,price:!1},removeTag:function(e){var t=s.filters.tagsArray.indexOf(e);t>-1&&s.filters.tagsArray.splice(t,1),s.filters.tags=s.filters.tagsArray.join(", "),s.filters.update()},clearSearch:function(){s.filters.search="",s.filters.searchString="",s.filters.active.search=!1,s.filters.update()},resetPriceRange:function(){s.filters.price.min=s.filters.price.options.floor,s.filters.price.max=s.filters.price.options.ceil,s.filters.active.price=!1},resetAll:function(){s.filters.resetOrder(),s.filters.resetPriceRange(),s.filters.clearSearch(),s.filters.tags="",s.filters.tagsArray.length=0},resetOrder:function(){s.filters.orderBy="",s.filters.active.order=!1},update:function(){s.getProducts(0,s.filters.currentLimit)},isActive:function(){return""!==s.filters.searchString||s.filters.tagsArray.length>0||"date"!==s.filters.orderBy&&""!==s.filters.orderBy||s.filters.active.price},price:{active:!1,options:{hidePointerLabels:!0,hideLimitLabels:!0,boundPointerLabels:!1,onEnd:function(e,t,r){s.filters.active.price=s.filters.price.min+s.filters.price.max===t+r}}}},s.filters.currentLimit=s.filters.limit+s.filters.offset,s.dragoverCallback=function(e){return e<s.currentItemDndIndex||e>s.currentItemDndIndex+1},s.dragstartCallback=function(e){var n=angular.element(event.target);s.filters.isActive()?(t.$emit("alert",{type:"error",message:"noDrag"}),event.preventDefault(),r(function(){n.removeClass("dndDraggingSource"),n.removeClass("dndDragging"),n.attr("draggable","false")})):s.currentItemDndIndex=e},s.toggleActionsPopover=function(e){return s.actionsPopoverId=s.actionsPopoverId===e?"":e,s.actionsPopoverId},s.getActiveTemplate=function(){return"partials/products-"+s.activeLayout+".html"},s.setProductsLayout=function(e){var t=s.localData||{},r=t.merchant||{},n=r.settings||{},a=n.products||{};s.activeLayout=e,s.actionsPopoverId="",t.merchant=r,t.merchant.settings=n,t.merchant.settings.products=a,t.merchant.settings.products.layout=e,o.set("app",t)},s.setProductImage=function(e){return{backgroundImage:"url("+e+")"}},s.categoryFilter=function(){s.filters.update()},s.loadMore=function(){s.filters.offset+=s.filters.currentLimit,s.isLoadingProducts=!0,a.getStoreProducts(s.filters.offset,s.filters.limit).then(function(e){var t;s.isLoadingProducts=!1,s.all=s.all.concat(e.data.Checkout_products),t=s.all.map(function(e){return e.Product_price}),s.filters.currentLimit=s.filters.limit+s.filters.offset,s.filters.price.min=Math.floor(Math.min.apply(Math,t)),s.filters.price.max=Math.max.apply(Math,t),s.filters.price.options.floor=s.filters.price.min!==s.filters.price.max?s.filters.price.min:0,s.filters.price.options.ceil=s.filters.price.max})},s.updateGrid=function(){s.actionsPopoverId="",s.filters.limit=15,"1"===s.filters.size?(s.gridSize="medium",s.filters.limit=12):"2"===s.filters.size&&(s.gridSize="large",s.filters.limit=9)},s.deleteProduct=function(e){i.open({template:"partials/alert-delete-social-network.html",className:"ngdialog-theme-plain",controller:function(){this.confirm=function(){i.close(),s.all=s.all.filter(function(t){return t.Product_id!==e})}},controllerAs:"modal"})},s.duplicateProduct=function(e){i.open({template:"partials/alert-delete-social-network.html",className:"ngdialog-theme-plain",controller:function(){this.confirm=function(){i.close(),s.actionsPopoverId=""}},controllerAs:"modal"})},s.getProducts=function(e,t){s.all.length=0,s.firstLoad=!0,s.isLoadingProducts=!0,a.getStoreProducts(e,t).then(function(e){var t=e.data.Checkout_products.map(function(e){return e.Product_price});s.all=e.data.Checkout_products,"EUR"===e.data.Checkout_isoCurrency&&(s.filters.currency="€"),s.filters.price.min=Math.floor(Math.min.apply(Math,t)),s.filters.price.max=Math.max.apply(Math,t),s.filters.price.options.floor=s.filters.price.min!==s.filters.price.max?s.filters.price.min:0,s.filters.price.options.ceil=s.filters.price.max,s.filters.active.price=!1,s.isLoadingProducts=!1,s.firstLoad=!1})},s.filters.update()}]),app.filter("byCategory",function(){return function(e,t){var r,n,a=[];if(void 0===t||""===t)return e;for(r=0;r<e.length;r++)for(n=0;n<e[r].categories.length;n++)e[r].categories[n].id===t.id&&a.push(e[r]);return a}}),app.filter("priceTag",function(){return function(e,t){var r,n,a=[];for(r=0;r<e.length;r++)(n=e[r].pricePromo?e[r].pricePromo:e[r].price)>t.price.min&&n<t.price.max&&a.push(e[r]);return a}}),app.component("productFilters",{templateUrl:"components/product-filters.component.html",controller:["$log","$scope","$timeout","$document","$element",function(e,t,r,n,a){var o=this,i=n.find(".aside-backdrop"),s=a.find(".popover");i.click(function(){s.addClass("hidden"),i.removeClass("in light")}),o.openFilters=function(){s.toggleClass("hidden"),i.addClass("in light"),r(function(){t.$broadcast("rzSliderForceRender")})},o.submitFilters=function(){o.model.tags.length>0&&(o.model.tagsArray=o.model.tags.split(",")),o.model.searchString=o.model.search,o.model.active.search=o.model.search.length>0,o.model.active.tags=o.model.tags.length>0,o.model.update()},o.sortProducts=function(){o.model.active.order="date"!==o.model.orderBy&&""!==o.model.orderBy,o.model.update()}}],bindings:{model:"="}}),app.controller("SettingsController",["ROUTES",function(e){this.tabsBasePath=e.merchant.settings.children.payment.name}]),app.component("discoverFilters",{templateUrl:"partials/modals/discover-filters.html",controller:["$log","$state","modalSrv","discoverSrv","publicDataSrv","DISCOVER",function(e,t,r,n,a,o){var i=this;e.log(t.params),i.sliderOptions={hidePointerLabels:!0,hideLimitLabels:!0,boundPointerLabels:!1,ceil:o.DEFAULTS.PRICE_MAX,floor:0},i.$onInit=function(){i.currency=a.getActiveCurrency().Currency_symbol,i.filters={order:t.params.order||"",priceMin:t.params.priceMin||0,priceMax:t.params.priceMax||o.DEFAULTS.PRICE_MAX}},i.applyFilters=function(){t.go(t.current,angular.merge(t.params,i.filters),{reload:!0,notify:!0}),r.closeAll()}}]}),app.component("loginForm",{templateUrl:"partials/modals/login-form.html",controllerAs:"loginController",restrict:"E",bindings:{bbcode:"@"},replace:!0,controller:["LOGIN","loginSrv","modalSrv","BLOOMBEES_OAUTH_URL","translationsSrv","locationSrv",function(e,t,r,n,a,o){function i(e){r.openWithOptions({template:"partials/modals/account-exists.html",controller:["ngDialog","modalSrv","$scope",function(t,r,n){var a=this;c.fadeOut(200),a.signin=function(){r.closeAll(),r.login(e)},a.retypeEmail=function(){n.closeThisDialog(),c.fadeIn(300),u.focus()}}],controllerAs:"$ctrl",plain:!1})}var s=this,l="#"+r.getOpenDialogs()[0],c=angular.element(document).find(l),u=c.find("input#email");s.email="",s.password="",s.redirectUrl=encodeURIComponent(location.href+"?auth={id}"),s.oAuthUrl=n,s.loading=!0,s.oAuthRedirect=t.oAuthRedirect.bind(t,{bbcode:s.bbcode}),s.submit=function(){s.loading=!0,t.authenticate(s.email,s.password).then(function(e){e?s.bbcode?o.reloadWithParams({bbcode:s.bbcode}):location.reload():(s.loading=!1,r.defaultNotice())},function(e){404===e.data.status?i(s.bbcode):r.defaultNotice(),s.loading=!1})},s.goToSignup=function(){r.closeAll(),r.signup(s.bbcode)},s.loading=!1}]}),app.constant("LOGIN",{ENDPOINTS:{AUTH:"/auth2017",EMAIL_LOGIN:"/auth/userpassword",CONFIRM_OAUTH:"/auth/oauthservice",CONFIRM_OAUTH_SIGNUP:"/register/user/oauthservice"},DEFAULT_REDIRECT_URL:"/merchant/dashboard",TOKEN_COOKIE:"bbtoken",LOGIN_ERROR_RESPONSE:"Error: error-user-notfound",LOGIN_WRONG_PASSWORD_RESPONSE:"Error: error-user-wrong-password",USER_DOES_NOT_EXIST_RESPONSE:"Error: error-user-does-not-have-password",REQUIRE_EMAIL_TEMPLATE:"partials/modals/require_email.html"}),app.service("loginSrv",["LOGIN","$http","$q","BLOOMBEES_API_URL","modalSrv","LANGUAGE","$location","BLOOMBEES_OAUTH_URL","$cookies",function(e,t,r,n,a,o,i,s,l){function c(r,a){var o={email:r,password:a};return t.post(n+e.ENDPOINTS.EMAIL_LOGIN,o).then(function(e){var t,r=e.data.success;return r&&e.data.data&&(t=e.data.data.dstoken,l.put("bbtoken",t)),r})}function u(e,r,a){return t({method:"POST",url:n+e,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(r)}).then(function(e){a.resolve({success:e.data.success,bbtoken:e.data.data&&e.data.data.dstoken?e.data.data.dstoken:null})},function(e){a.resolve({success:!1,status:e.data.status})})}function d(t,n,i){var s=r.defer(),l={id:t},c=n?e.ENDPOINTS.CONFIRM_OAUTH_SIGNUP:e.ENDPOINTS.CONFIRM_OAUTH;return n&&(l.User_language=o),n&&i?a.open(e.REQUIRE_EMAIL_TEMPLATE,"RequireEmailController","requireEmail","require-email",{successCallback:function(){function e(e){l.User_email=e,l.User_language=o,u(c,l,s)}return e}},null,null,null,!0):u(c,l,s),s.promise}function p(e,t){var r,n=location.origin+location.pathname,a=i.search(),o=e||{};a.auth="idplaceholder",a=angular.merge({},o,a),r=s+"/"+t+"?ret="+encodeURIComponent(n+"?"+$.param(a)),r=r.replace("idplaceholder","{id}"),location.href=r}return{authenticate:c,confirmOAuth:d,oAuthRedirect:p}}]),app.component("productCardDiscover",{templateUrl:"components/product-card-discover.html",controllerAs:"discover",bindings:{product:"<",select:"&"},controller:["$scope","$timeout","$state","$location","publicDataSrv","modalSrv","discoverSrv","PROMOTER_INFO","promoterInfoSrv","$q",function(e,t,r,n,a,o,i,s,l,c){var u=this;u.getCommission=function(e,t){var r=Math.floor(e*t)/100;return parseFloat(r.toFixed(2))},u.renderPrice=function(e){return parseFloat(Number(e).toFixed(2))},u.$onInit=function(){u.productInfo={currency:a.currencyToSymbol(u.product.Product_isoCurrency),product:u.product,commission:u.getCommission(u.product.Product_price,u.product.Product_promoterCommissionPercent),setProductImage:u.setProductImage}},u.setProductImage=function(e){return{backgroundImage:"url("+e+")"}},u.shareAndEarn=function(){isAuth?s.BEEVIRAL_ID?o.shareAndEarn(u.product):l.requestPromoterInfo(function(e,t){var r=c.defer();return l.submitPromoterInfo(e,t).then(function(e){e.success?(o.shareAndEarn(u.product),r.resolve()):r.reject()},r.reject),r.promise}):o.signup(u.productInfo.product.Product_bbcode)},u.selectProduct=function(){u.select()}}]}),app.controller("RequireEmailController",["successCallback",function(e){this.email="",this.loading=!1,this.callback=function(t){this.loading=!0,e(t)}}]),app.constant("REQUIRE_PROMOTER_INFO",{ENDPOINTS:{SUBMIT:"/register/beeviral/"}}),app.controller("PromoterInfoController",["$scope","successCallback","publicDataSrv","$q","modalSrv",function(e,t,r,n,a){var o,i,s=this;s.loading=!0,s.currency=null,s.country=null,s.currencies=[],s.countries=[],o=r.getCountries().then(function(e){s.countries=e,s.country=s.countries[0].iso}),i=r.getCurrencies().then(function(e){s.currencies=e,s.currency=s.currencies[0].Currency_isoCode}),n.all([o,i]).then(function(){s.loading=!1,r.getGeo().then(function(e){s.country=e.COUNTRY,s.currency=e.CURRENCY})}),s.callback=function(){s.loading=!0,t(s.currency,s.country).then(function(){e.closeThisDialog()},function(){a.defaultNotice(),s.loading=!1})}}]),app.service("promoterInfoSrv",["modalSrv","$q","$http","REQUIRE_PROMOTER_INFO","BLOOMBEES_API_URL","USER_ID","$cookies","PROMOTER_INFO",function(e,t,r,n,a,o,i,s){function l(t){return e.open("partials/modals/require_promoter_info.html","PromoterInfoController","requirePromoterInfo","require-promoter-info",{successCallback:function(){return t}})}function c(e,t){return r.post(a+n.ENDPOINTS.SUBMIT+o,{Store_currency:e,Store_country:t}).then(function(e){return e.data.data&&200===e.data.status&&(i.put("bbrefresh",1),s.BEEVIRAL_ID=e.data.data.Store_beeViralId),{success:e.data.success,promoterInfo:e.data.data?e.data.data:null}})}return{requestPromoterInfo:l,submitPromoterInfo:c}}]),app.directive("scrollControls",["$log","$timeout",function(e,t){return{replace:!0,restrict:"E",template:'<div><div class="slider-controls slide-left"><span class="icon bb-icon-left_arrow"></span></div><div class="slider-controls slide-right" ng-hide="noRight"> <span class="icon bb-icon-right-angle"></span></div></div>',scope:{container:"@",show:"=",appendToContainer:"<"},link:function(e,r){var n=this;n.getVisibleWidth=function(e){return e.parent().width()-e.width()},n.getChildrenWidth=function(e){var t,r=0,n=e.children();for(t=0;t<n.length;t++)r+=$(n[t])[0].offsetWidth;return r},t(function(){var t=$(e.container),a=t.width(),o=n.getChildrenWidth(t),i=r.find(".slider-controls.slide-left"),s=r.find(".slider-controls.slide-right");n.width=n.getChildrenWidth(t),e.appendToContainer&&(t.append('<div class="slider-controls slide-left hidden-xs"><span class="icon bb-icon-left_arrow"></span></div><div class="slider-controls slide-right hidden-xs" ng-hide="noRight" ng-show="show"> <span class="icon bb-icon-right-angle"></span></div>'),i=t.find(".slider-controls.slide-left"),s=t.find(".slider-controls.slide-right"),s.css("right",n.width+"px"),r.addClass("hidden")),o<=a&&($(i).hide(),$(s).hide()),0===t.scrollLeft()&&$(i).hide(),t.on("scroll",function(){var r=t.scrollLeft(),a=t[0].scrollWidth-t[0].clientWidth;a!==n.offset&&n.offset&&(n.width=n.getChildrenWidth(t)),n.offset=a,a<2?($(i).hide(),$(s).hide()):(0===r&&0!==a?$(i).fadeOut(300):$(i).fadeIn(300),r===a&&0!==a?$(s).fadeOut(300):$(s).fadeIn(300)),e.appendToContainer&&s.css("right",n.width+"px")}),i.hover(function(){var e=2*n.getChildrenWidth(t);t.animate({scrollLeft:0},e)},function(){t.stop(!0,!1)}),s.hover(function(){var e=n.getChildrenWidth(t),r=2*e;t.animate({scrollLeft:e},r)},function(){t.stop(!0,!1)})})}}}]),app.directive("shareAndEarn",["ngDialog",function(e){return{restrict:"A",scope:{product:"<"},controller:["$log","modalSrv",function(e,t){}],link:function(e,t,r){}}}]),app.component("signupForm",{templateUrl:"partials/modals/signup-form.html",controllerAs:"signupController",restrict:"E",bindings:{bbcode:"@"},replace:!0,controller:["SIGNUP","LOGIN","signupSrv","modalSrv","BLOOMBEES_OAUTH_URL","translationsSrv","loginSrv","locationSrv",function(e,t,r,n,a,o,i,s){function l(e){n.openWithOptions({template:"partials/modals/account-exists.html",controller:["ngDialog","modalSrv","$scope",function(t,r,n){var a=this;d.fadeOut(200),a.signin=function(){r.closeAll(),r.login(e)},a.retypeEmail=function(){n.closeThisDialog(),d.fadeIn(300),p.focus()}}],controllerAs:"$ctrl",plain:!1})}
var c=this,u="#"+n.getOpenDialogs()[0],d=angular.element(document).find(u),p=d.find("input#email");c.registerForm={},c.links=e.LINKS,c.name="",c.email="",c.password="",c.repeatPassword="",c.PASSWORD_MIN_LENGTH=e.PASSWORD_MIN_LENGTH,c.oAuthRedirect=i.oAuthRedirect.bind(i,{bbcode:c.bbcode,signup:!0}),c.oAuthUrl=a,c.loading=!0,c.submit=function(){c.loading=!0,r.signup(c.name,c.email,c.password).then(function(e){e?c.bbcode?s.reloadWithParams({bbcode:c.bbcode,newAccount:!0}):s.reloadWithParams({newAccount:!0}):(n.defaultNotice(),c.loading=!1)},function(e){c.loading=!1,409===e.status?(p.val(""),c.registerForm.email.$setViewValue(""),l(c.bbcode)):n.defaultNotice()})},c.goToLogin=function(){n.closeAll(),n.login(c.bbcode)},c.loading=!1}]}),app.constant("SIGNUP",{ENDPOINT:"/register/user",LINKS:{TERMS_AND_CONDITIONS:"https://bloombees.com/terms-and-conditions",PRIVACY_POLICY:"https://bloombees.com/privacy-policy"},PASSWORD_MIN_LENGTH:8}),app.service("signupSrv",["SIGNUP","LOGIN","LANGUAGE","loginSrv","$q","$http","BLOOMBEES_API_URL",function(e,t,r,n,a,o,i){function s(t,s,l){var c=a.defer(),u={User_email:s,User_name:t,User_password:l,User_language:r};return o.post(i+e.ENDPOINT,u).then(function(e){e.data&&e.data.success?n.authenticate(s,l).then(function(e){c.resolve(e)}):c.reject(e)},c.reject),c.promise}return{signup:s}}]),app.component("voteProduct",{templateUrl:"components/vote-product.html",bindings:{product:"<",voted:"="},controllerAs:"vote",controller:["$timeout","voteSrv","USER_ID",function(e,t,r){var n=this;n.isVoted=n.product.Product_liked||n.product.Product_disliked,n.like=function(){n.product.Product_liked?n.unlike():t.like(n.product.Product_id,n.product.Product_bbcode,r).then(function(t){n.product=t.data.Products[0],n.isVoted=!0,n.voted=!0,e(function(){n.voted=!1},1e3)})},n.dislike=function(){n.product.Product_disliked?n.unlike():t.dislike(n.product.Product_id,n.product.Product_bbcode,r).then(function(t){n.product=t.data.Products[0],n.isVoted=!0,n.voted=!0,e(function(){n.voted=!1},1e3)})},n.unlike=function(){t.unlike(n.product.Product_id,n.product.Product_bbcode,r).then(function(e){n.product=e.data.Products[0],n.isVoted=!1})}}]}),app.constant("VOTE",{ENDPOINTS:{LIKE:"/beeViral/likes/like",DISLIKE:"/beeViral/likes/dislike",UNLIKE:"/beeViral/likes/unlike"}}),app.service("voteSrv",["$resource","BLOOMBEES_API_URL","VOTE",function(e,t,r){function n(n,a,o){var i={Product_id:n,Product_bbcode:a,User_id:o};return e(t+r.ENDPOINTS.LIKE).save(i).$promise}function a(n,a,o){var i={Product_id:n,Product_bbcode:a,User_id:o};return e(t+r.ENDPOINTS.DISLIKE).save(i).$promise}function o(n,a,o){var i={Product_id:n,Product_bbcode:a,User_id:o};return e(t+r.ENDPOINTS.UNLIKE).save(i).$promise}return{like:n,dislike:a,unlike:o}}]),app.constant("DISCOVER",{ENDPOINTS:{PRODUCTS:"/beeViral/products",DISCOVER:"/beeViral/discover",CATEGORIES:"/beeViral/cats?__reload",SUBCATEGORIES:"/beeViral/cats?__reload",STOREFRONT:"/beeViral/storefront/products",SOCIALNETWORK:"/socialnetworks/facebook/check"},DEFAULTS:{LIMIT:12,PRICE_MAX:3e3},ORDER:{commission:!0,popular:!0,date:!0,seller:!0},VIEW:{popular:"Popular",recommended:"Recommended",all:"All"}}),app.controller("DiscoverController",["$timeout","$scope","$rootScope","discoverSrv","USER_ID","publicDataSrv","modalSrv","LANGUAGE","DISCOVER","$state","PROMOTER_INFO","promoterInfoSrv","$q","translationsSrv",function(e,t,r,n,a,o,i,s,l,c,u,d,p,f){var m,h,g=this;if(g.products={},g.search=[],g.selectedProducts=[],g.isModalFilters=!1,g.loadMoreData={limit:l.DEFAULTS.LIMIT,offset:0},g.currentLimit=g.loadMoreData.offset+g.loadMoreData.limit,g.currency=o.getActiveCurrency().Currency_symbol,g.orderBy=n.getOrderBy(),g.views=n.getViews(),g.filters={priceMin:c.params.priceMin||0,priceMax:c.params.priceMax||l.DEFAULTS.PRICE_MAX,order:g.orderBy[c.params.order]?c.params.order:null},c.params.uniqueId&&(g.filters.Store_uniqueId=c.params.uniqueId),g.searchTitle=c.params.view||null,g.price={active:c.params.priceMin&&c.params.priceMax,options:{hidePointerLabels:!0,hideLimitLabels:!0,boundPointerLabels:!1,ceil:l.DEFAULTS.PRICE_MAX,floor:0,onEnd:function(e,t,r){g.price.active=g.filters.priceMin+g.filters.priceMax===t+r,g.isModalFilters||g.filterProducts()}}},g.lang=s,g.categories=n.categories,g.sections=n.sections,i.onboarding(),c.params.view&&g.views[c.params.view]&&g.search.push({view:!0,text:c.params.view}),c.params.cat&&g.search.push({category:!0,text:c.params.cat}),c.params.subcat&&g.search.push({subcategory:!0,text:c.params.subcat}),c.params.search)for(h=c.params.search.split(","),m=0;m<h.length;m++)g.search.push({text:h[m]});c.params.newAccount&&(c.go(c.current,{newAccount:null},{notify:!1,reload:!1}),r.$emit("alert",{type:"success",message:"successfulPromoterSignup"})),g.showFiltersModal=function(){g.isModalFilters=!0,i.openWithOptions({template:"<discover-filters></discover-filters>",plain:!0})},g.applyFilters=function(){g.isModalFilters=!1,c.go(c.current,g.setUrlParams(g.search,g.filters),{reload:!0,notify:!1})},g.checkActiveFilters=function(){return g.price.active||g.filters.order},g.clearAllFilters=function(){g.price.active=!1,g.filters.priceMin=0,g.filters.priceMax=l.DEFAULTS.PRICE_MAX,g.filters.order=null,c.transitionTo(c.current,g.setUrlParams(g.search,g.filters),{reload:!1,notify:!1})},g.clearAll=function(){g.search.length=0,g.price.active=!1,g.filters.order=null,c.transitionTo(c.current,g.setUrlParams([],{}),{reload:!1,notify:!1})},g.getCategoryName=function(e){return e[g.lang]},g.addCategory=function(e,t){var r={id:e,category:!0,text:t};g.search.push(r)},g.addSubcategory=function(e,t){var r={id:e,subcategory:!0,text:t};g.search.push(r)},g.getProductSectionType=function(e,t){return{text:t,popular:e.indexOf("popular")>-1,recommended:e.indexOf("recommended")>-1,all:e.indexOf("all")>-1}},g.viewAll=function(e){var t={text:e.text};g.searchTitle=e.text,e.all&&(t.param="all"),e.popular&&(t.param="popular"),e.recommended&&(t.param="recommended"),g.search.push(t)},g.loadMore=function(){g.loadingMore=!0,g.loadMoreData.offset+=g.loadMoreData.limit,n.getSearchResults(g.loadMoreData.offset,g.loadMoreData.limit,g.search,g.filters).then(function(e){g.searchResults=g.searchResults.concat(e.data.Products),g.currentLimit=g.loadMoreData.offset+g.loadMoreData.limit,g.loadingMore=!1})},g.filterProducts=function(){g.loading=!0,c.go(c.current,g.setUrlParams(g.search,g.filters),{reload:!1,notify:!1}),n.getSearchResults(0,l.DEFAULTS.LIMIT,g.search,g.filters).then(function(e){g.searchResults=e.data.Products,g.loading=!1})},g.checkMainCategory=function(e){var t=!1;return e.map(function(e){e.category&&(t=!0)}),t},g.setUrlParams=function(e,t){var r={},n={},a=[],o=[];return e.map(function(e){e.category||e.subcategory||e.param||e.view?(e.category&&(r.cat=e.text),e.subcategory&&a.push(e.text),e.param&&(r.view=e.param),e.view&&(r.view=e.text)):o.push(e.text)}),r.search=o.join(","),r.subcat=a.join(","),g.price.active?n=t:n.order=t.order,c.params.uniqueId&&(r.uniqueId=c.params.uniqueId),angular.merge(r,n)},g.selectProduct=function(e){var t,r=g.selectedProducts.indexOf(e);return r>-1?(t=!1,g.selectedProducts.splice(r,1),n.selectedProducts=g.selectedProducts):(t=!0,g.selectedProducts.push(e),n.selectedProducts=g.selectedProducts),t},g.clearSelectedProducts=function(){g.selectedProducts.length=0,n.selectedProducts=g.selectedProducts},g.updateAddedProducts=function(e){angular.forEach(g.sections,function(t){t.Section_items.map(function(t){e.indexOf(t.Product_id)>-1&&(t.StoreFront_dateInserted=!0)})}),g.searchResults&&g.searchResults.length>0&&g.searchResults.map(function(t){e.indexOf(t.Product_id)>-1&&(t.StoreFront_dateInserted=!0)})},g.isSelectedProduct=function(e){return n.isSelectedProduct(e)},g.getTranslationFromElement=function(e){return f.getTranslationFromElement(e)},g.addToStorefront=function(){g.selectedProducts.length>1?n.addProductsToStorefront(g.selectedProducts).then(function(r){r.success?(g.updateAddedProducts(g.selectedProducts),g.clearSelectedProducts(),e(function(){t.$emit("alert",{type:"success",message:"addedProductsToStorefront"})})):e(function(){t.$emit("alert",{type:"error",message:"defaultError"})})}):1===g.selectedProducts.length&&n.addProductToStorefront(g.selectedProducts[0]).then(function(r){r.success?(g.updateAddedProducts(g.selectedProducts),g.clearSelectedProducts(),e(function(){t.$emit("alert",{type:"success",message:"addedProductToStorefront"})})):e(function(){t.$emit("alert",{type:"error",message:"defaultError"})})})},isAuth&&c.params.bbcode&&n.getProductByBbcode(c.params.bbcode).then(function(e){var t=e.data.Products[0];u.BEEVIRAL_ID?i.shareAndEarn(t):d.requestPromoterInfo(function(e,r){var n=p.defer();return d.submitPromoterInfo(e,r).then(function(e){e.success?(i.shareAndEarn(t),n.resolve()):n.reject()},n.reject),n.promise})}),t.$watch(angular.bind(g,function(){return g.search}),function(t,r){var a=g.checkMainCategory(r);g.hasMainCategory=g.checkMainCategory(t),t.length>0?(g.loading=!0,(g.hasMainCategory&&!a||angular.equals(t,r))&&n.getSubcategories().then(function(e){g.subcategories=e.data.TagCats}),c.go(c.current,g.setUrlParams(g.search,g.filters),{reload:!1,notify:!1}),e(function(){var e,t=angular.element(".tags"),r=angular.element("ul.tag-list"),n=t.find("input"),a=0;for(e=0;e<r[0].children.length;e++)a+=$(r[0].children[e])[0].offsetWidth+5;r.css("min-width",a),t.animate({scrollLeft:n[0].offsetWidth+r[0].offsetWidth},"slow")}),n.getSearchResults(0,l.DEFAULTS.LIMIT,t,g.filters).then(function(e){g.searchResults=e.data.Products,g.loading=!1})):c.params.bbcode||(angular.element("ul.tag-list").css("min-width",0),g.clearAll())},!0),r.$on("currencyChanged",function(){var e=isAuth?a:null,t=c.params.uniqueId||null;g.search.length>0&&(g.loading=!0,n.getSearchResults(0,g.currentLimit,g.search,g.filters).then(function(e){g.searchResults=e.data.Products,g.loading=!1})),n.getProducts(0,l.DEFAULTS.LIMIT,null,e,t).then(function(r){g.products.all=r.data.Products,n.getProducts(0,8,"popular",e,t).then(function(r){g.products.popular=r.data.Products,n.getProducts(0,8,"recommended",e,t).then(function(e){g.products.recommended=e.data.Products})})})})}]),app.service("discoverSrv",["$log","userInfoSrv","publicDataSrv","$resource","DISCOVER","BLOOMBEES_API_URL","USER_ID","LANGUAGE",function(e,t,r,n,a,o,i,s){var l=this;l.categories=[],l.selectedProducts=[],l.getProducts=function(e,t,i,s,l){var c={limit:t,cursor:e,currency:r.getActiveCurrency().Currency_isoCode},u=o+a.ENDPOINTS.PRODUCTS;return l&&(c.Store_uniqueId=l),i&&(c.modifier=i,u+="?:modifier"),isAuth&&(c.User_id=s),n(u,c).get().$promise},l.getCategories=function(e){return n(o+a.ENDPOINTS.CATEGORIES,{lang:e}).get().$promise},l.getSubcategories=function(e){return n(o+a.ENDPOINTS.SUBCATEGORIES,{lang:e}).get().$promise},l.getOrderBy=function(){return a.ORDER},l.getViews=function(){return a.VIEW},l.getSearchResults=function(e,t,s,l){var c={limit:t,cursor:e,currency:r.getActiveCurrency().Currency_isoCode},u=o+a.ENDPOINTS.PRODUCTS,d=null,p=[],f=null,m=[];return s.map(function(e){e.category||e.subcategory||e.param||e.view?(e.category&&(d=e.text),e.subcategory&&p.push(e.text),e.param&&(f=e.param),e.view&&(f=e.text)):m.push(e.text)}),m.length>0&&(c.search=m.join(",")),p.length>0&&(c.subcat=p.join(",")),d&&(c.cat=d),f&&(c.modifier=f,u+="?:modifier"),isAuth&&(c.User_id=i),c=angular.merge(c,l),n(u,c).get().$promise},l.getProductByBbcode=function(e){var t={Product_bbcode:e,User_id:i,currency:r.getActiveCurrency().Currency_isoCode};return n(o+a.ENDPOINTS.PRODUCTS,t).get().$promise},l.selectProduct=function(e){l.selectedProducts.push(e)},l.deselectProduct=function(e){var t=l.selectedProducts.indexOf(e);t>-1&&l.selectedProducts.splice(t,1)},l.isSelectedProduct=function(e){return l.selectedProducts.indexOf(e)>-1},l.addProductToStorefront=function(e){return n(o+a.ENDPOINTS.STOREFRONT+"/:user_id/:product_id",{user_id:i,product_id:e}).save().$promise},l.addProductsToStorefront=function(e){var t={Product_ids:JSON.stringify(e)};return n(o+a.ENDPOINTS.STOREFRONT+"/:user_id",{user_id:i}).save(t).$promise},l.getProductSections=function(e){var t=isAuth?i:null,l={lang:s,User_id:t,Store_uniqueId:e,currency:r.getActiveCurrency().Currency_isoCode};return n(o+a.ENDPOINTS.DISCOVER,l).get().$promise}}]),app.factory("$storage",["$window",function(e){return{get:function(t){var r=e.localStorage[t];return r?JSON.parse(r):null},set:function(t,r){e.localStorage[t]=JSON.stringify(r)},remove:function(t){e.localStorage.removeItem(t)}}}]),app.service("locationSrv",["$location",function(e){function t(e,t){var r,n=t.split("?")[0],a=[],o=t.indexOf("?")!==-1?t.split("?")[1]:"";if(""!==o){for(a=o.split("&"),r=a.length-1;r>=0;r-=1)a[r].split("=")[0]===e&&a.splice(r,1);n=n+"?"+a.join("&")}return n}function r(e){var r=location.href;e.forEach(function(e){r=t(e,r)}),location.href=r}function n(t){var r=location.origin+location.pathname,n=angular.merge({},e.search(),t);location.href=r+"?"+$.param(n)}return{reloadWithoutParams:r,reloadWithParams:n}}]);